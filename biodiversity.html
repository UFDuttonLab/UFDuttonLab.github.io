<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biodiversity Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .prose {
            max-width: 65ch;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <main id="app-container" class="min-h-screen p-4 sm:p-6 lg:p-8"></main>
    <footer class="text-center py-6 text-sm text-slate-500">
        <p>
            Developed by UF Dutton Lab •
            <a href="https://ufduttonlab.github.io" target="_blank" rel="noopener noreferrer" class="font-medium text-blue-600 hover:underline">
                ufduttonlab.github.io
            </a>
        </p>
    </footer>
    <script>
        // --- DATA AND CONFIGURATION ---
        // Inlined SVG icons to remove external dependencies
        const ICONS = {
            Dna: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14.01V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8.01"/><path d="M4 9.99V6a2 2 0 0 0-2 2v8.01a2 2 0 0 0 2 2H6"/><path d="M20 9.99V6a2 2 0 0 1 2 2v8.01a2 2 0 0 1-2 2h-2"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="m4.93 19.07 1.41-1.41"/><path d="m17.66 6.34 1.41-1.41"/></svg>`,
            BarChart: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>`,
            Heart: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
            TrendingUp: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>`,
            Globe: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>`,
            Users: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
            Shield: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
            Leaf: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 4 13V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><path d="M15.09 13.52A15 15 0 0 1 22 10V4a2 2 0 0 0-2-2h-1a2 2 0 0 0-2 2v1c0 1.1.9 2 2 2"/></svg>`,
            Map: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>`,
            Star: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
            CheckCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            Lock: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>`,
            ChevronLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>`,
            ChevronRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>`,
            Home: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
            RotateCcw: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>`,
            Copy: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>`,
            PlusCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>`,
            Trash: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>`,
            Award: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>`,
        };
        const GAME_MODULES = [
            { id: 'levels-of-biodiversity', title: 'Levels of Biodiversity', description: 'Genetic, species, and ecosystem diversity', icon: 'Dna', color: '#e74c3c' },
            { id: 'measuring-biodiversity', title: 'Measuring Biodiversity', description: 'Alpha, beta, and gamma diversity measures', icon: 'BarChart', color: '#3498db' },
            { id: 'ecosystem-services', title: 'Ecosystem Services', description: 'Benefits biodiversity provides to humans', icon: 'Heart', color: '#27ae60' },
            { id: 'evolutionary-processes', title: 'Evolutionary Processes', description: 'Speciation, extinction, and adaptation', icon: 'TrendingUp', color: '#f39c12' },
            { id: 'ecological-processes', title: 'Ecological Processes', description: 'Community assembly and biogeography', icon: 'Globe', color: '#9b59b6' },
            { id: 'species-interactions', title: 'Species Interactions', description: 'Food webs, competition, mutualism', icon: 'Users', color: '#e67e22' },
            { id: 'human-impacts', title: 'Human Impacts', description: 'Threats to biodiversity', icon: 'Shield', color: '#c0392b' },
            { id: 'conservation-biology', title: 'Conservation Biology', description: 'Protection and restoration strategies', icon: 'Leaf', color: '#16a085' },
            { id: 'biodiversity-gradients', title: 'Biodiversity Gradients', description: 'Theories explaining diversity patterns', icon: 'Map', color: '#2980b9' }
        ];
        const MODULE_CONTENT = {
            'levels-of-biodiversity': [
                {
                    id: 'genetic-diversity',
                    title: 'Genetic Diversity',
                    description: 'Variation within species at the DNA level',
                    content: {
                        explanation: 'Genetic diversity refers to the total number of genetic characteristics in the genetic makeup of a species. It includes diversity within populations (different versions of genes) and between populations (population differences). Higher genetic diversity provides raw material for adaptation and evolutionary responses to environmental change.',
                        visual: '🧬 DNA Variation → 🔀 Different Gene Versions → 🦋🦋🦋 Population Differences → 🌱 Ability to Adapt',
                        example: 'Cheetahs have extremely low genetic diversity due to a population bottleneck about 12,000 years ago - they share over 99% of their DNA. In contrast, humans show high genetic diversity with about 0.1% DNA differences between individuals, providing greater evolutionary potential.',
                        limitations: 'Challenges include: (1) Genetic diversity does not always match with physical diversity, (2) Small populations can lose genetic diversity through random chance regardless of natural selection, (3) Some species function well with low genetic diversity, (4) Measuring genetic diversity requires expensive molecular techniques, and (5) Neutral genetic diversity may not reflect the ability to adapt.'
                    },
                    challenge: { question: 'You are studying two island bird populations. Island A has high genetic diversity. Island B has low genetic diversity. A new disease arrives. Which population is more likely to survive and why?', options: ['Island A - higher genetic diversity provides more immune system variants', 'Island B - genetic uniformity means proven successful traits', 'Both equally - population size is the same', 'Neither - diseases always cause extinction'], correct: 0, explanation: 'Island A has higher evolutionary potential. Greater genetic diversity means more variants of an immune system genes, increasing the probability that some individuals carry versions that provide disease resistance.' }
                },
                {
                    id: 'species-diversity',
                    title: 'Species Diversity',
                     description: 'Number and relative abundance of species',
                    content: {
                        explanation: 'Species diversity combines species richness (number of species) and species evenness (relative abundance). A community with many species in equal abundance has higher diversity than one with the same number of species but dominated by a few. Species diversity is the most commonly measured level of biodiversity.',
                        visual: '🦋 Species 1 → 🐝 Species 2 → 🐛 Species 3 → 🕷️ Species 4 → 📊 Community Diversity',
                        example: 'A tropical rainforest plot may contain 300 tree species in one hectare with relatively even abundance. A temperate forest of the same size might have 30 tree species, often dominated by 2-3 species like oak and maple. The tropical forest has higher species diversity both in richness and evenness.',
                        limitations: 'Limitations include: (1) Species concepts can be unclear, (2) Sampling bias affects species detection, (3) Rare species are often missed in surveys, (4) Different groups of organisms require different survey methods, and (5) Species diversity does not capture functional or evolutionary diversity differences.'
                    },
                    challenge: { question: 'Two forest communities each have 20 tree species. Community A: each species represents 5% of individuals. Community B: one species is 70% of individuals. Which has higher species diversity?', options: ['Community A - higher evenness despite equal richness', 'Community B - dominance indicates successful adaptation', 'Equal - same number of species', 'Cannot determine without more information'], correct: 0, explanation: 'Community A has higher species diversity because it combines equal species richness (20 species each) with much higher evenness. Species diversity accounts for both richness and evenness.' }
                },
                {
                    id: 'ecosystem-diversity',
                    title: 'Ecosystem Diversity',
                    description: 'Variety of habitats and ecological communities',
                    content: {
                        explanation: 'Ecosystem diversity encompasses the variety of biological communities, their physical environments, and ecological processes. It includes habitat diversity, community types, and ecosystem functions. Ecosystem diversity operates at landscape scales and provides the environmental context for species and genetic diversity.',
                        visual: '🏔️ Mountains → 🌊 Rivers → 🌲 Forests → 🏜️ Deserts → 🌍 Landscape Diversity',
                        example: 'Costa Rica, despite covering only 0.03% of Earth\'s surface, contains about 5% of global biodiversity partly due to high ecosystem diversity: 12 ecological zones from lowland rainforests to cloud forests to dry forests, coral reefs, mangroves, and high-altitude ecosystems.',
                        limitations: 'Challenges include: (1) Ecosystem boundaries are often arbitrary and scale-dependent, (2) Classification systems vary among researchers, (3) Human-modified ecosystems are difficult to categorize, (4) Ecosystem functions may be similar despite structural differences, and (5) Climate change is rapidly altering ecosystem distributions.'
                    },
                    challenge: { question: 'A development project will destroy 1000 hectares. Option A: 1000ha of a single forest type. Option B: 200ha each of forest, wetland, grassland, shrubland, and river habitat. Which loss is more severe?', options: ['Option A - larger continuous area lost', 'Option B - multiple ecosystem types lost', 'Equal - same total area destroyed', 'Option A - forests are more valuable'], correct: 1, explanation: 'Option B represents a greater loss of ecosystem diversity because five different ecosystem types are destroyed versus one. Each ecosystem supports unique species and processes.' }
                },
                {
                    id: 'alleles',
                    title: 'Alleles',
                    description: 'Understanding the source of genetic variation.',
                    content: {
                        explanation: 'Alleles are different versions of the same gene. For example, the gene for eye color can have alleles that result in blue eyes, brown eyes, or green eyes. The combination of alleles an individual possesses determines their traits. The variety of alleles in a population is the foundation of genetic diversity.',
                        visual: 'Gene 🧬 → Different Versions (A, a) → Alleles',
                        example: 'In pea plants, a single gene controls flower color. The "P" allele produces purple flowers, while the "p" allele produces white flowers. A plant can have PP, Pp, or pp combinations.'
                    },
                    challenge: { question: 'What is the ultimate source of new alleles, which are the basis of genetic diversity?', options: ['Natural selection', 'Genetic drift', 'Mutation', 'Gene flow'], correct: 2, explanation: 'Mutation, a change in the DNA sequence, is the ultimate source of new genetic variation (alleles) in a population.' }
                },
                {
                    id: 'bottleneck-effect',
                    title: 'Bottleneck Effect',
                    description: 'How population reductions affect diversity.',
                     content: {
                        explanation: 'A population bottleneck is an event that drastically reduces the size of a population. The surviving population often has less genetic variation than the original population because many alleles are lost by chance. This can make the population more vulnerable to future environmental changes or diseases.',
                        visual: 'Diverse Population (🔴🔵🟢⚫️⚪️) → Event → Reduced Population (🔴🔵) → Recovered Population (Less Diverse)',
                        example: 'The Northern elephant seal was hunted to near extinction in the 1890s, with only about 20 individuals remaining. Although the population has recovered to over 100,000, they have much lower genetic diversity than the Southern elephant seal, which was not so severely hunted.'
                     },
                    challenge: { question: 'A population of seals is reduced from 10,000 to 100 individuals due to overhunting. This is an example of:', options: ['The founder effect', 'A population bottleneck', 'Adaptive radiation', 'Gene flow'], correct: 1, explanation: 'A population bottleneck occurs when a population\'s size is sharply reduced, leading to a loss of genetic diversity, as seen in the Northern elephant seal.' }
                },
                {
                    id: 'species-richness-evenness',
                    title: 'Richness vs Evenness',
                    description: 'Distinguishing two key components of species diversity.',
                     content: {
                        explanation: 'Species diversity has two main components: richness and evenness. Richness is simply the number of different species. Evenness is a measure of the relative abundance of the different species. A community is considered more diverse if it has high richness AND high evenness.',
                        visual: 'Richness = # of types. Evenness = Balance of types.',
                        example: 'Forest A has 100 trees of 10 different species (10 trees each). Forest B has 100 trees of 10 different species, but 91 trees are one species and the other 9 species are represented by one tree each. Both have the same richness (10 species), but Forest A has much higher evenness and is therefore considered more diverse.'
                     },
                    challenge: { question: 'A community with high species richness but low species evenness would be best described as:', options: ['Having many species, with a few species being highly dominant', 'Having few species, all in equal abundance', 'Having many species, all in equal abundance', 'Having few species, with one being highly dominant'], correct: 0, explanation: 'High richness means many species are present, but low evenness means their abundances are very unequal, with a few species making up most of the individuals.' }
                },
                {
                    id: 'functional-diversity',
                    title: 'Functional Diversity',
                    description: 'Diversity of ecological roles in an ecosystem.',
                     content: {
                        explanation: 'Functional diversity is the variety of ecological roles or functions that species perform in an ecosystem. These roles include processes like decomposition, pollination, nitrogen fixation, and predation. An ecosystem\'s health and stability can depend heavily on its functional diversity.',
                        visual: '🦋 Pollinator + 🐛 Herbivore + 🍄 Decomposer = Functional Groups',
                        example: 'A grassland might have 10 grass species (high species richness) but if they all consume the same nutrients and grow at the same time, it has low functional diversity. Another grassland with a grass, a nitrogen-fixing legume, and a deep-rooted wildflower has higher functional diversity, even if it has fewer species overall.'
                     },
                    challenge: { question: 'What is functional diversity?', options: ['The diversity of species\' evolutionary histories', 'The variety of ecological roles or functions that species fill in an ecosystem', 'The total number of species in an ecosystem', 'The geographic distribution of species'], correct: 1, explanation: 'Functional diversity considers the roles organisms play, such as nitrogen-fixers, decomposers, or pollinators. An ecosystem can have high species richness but low functional diversity if all species perform the same role.' }
                },
                {
                    id: 'phylogenetic-diversity',
                    title: 'Phylogenetic Diversity',
                    description: 'The importance of evolutionary history.',
                     content: {
                        explanation: 'Phylogenetic diversity is a measure of biodiversity that incorporates the evolutionary relationships between species. A community with species from many different branches of the tree of life has higher phylogenetic diversity than a community with the same number of species that are all closely related.',
                        visual: 'Tree of Life 🌳 → More Branch Length Covered → Higher Phylogenetic Diversity',
                        example: 'An ecosystem with a mammal, a bird, an amphibian, and a fish is more phylogenetically diverse than an ecosystem with four different species of mice. Protecting phylogenetic diversity means preserving more of the total evolutionary history of life on Earth.'
                     },
                    challenge: { question: 'Why might conserving phylogenetic diversity be important?', options: ['It ensures the protection of beautiful species', 'It maximizes the number of species saved', 'It protects a greater amount of unique evolutionary history', 'It is the easiest type of diversity to measure'], correct: 2, explanation: 'Phylogenetic diversity represents the total branch length on the evolutionary tree. Conserving it means protecting species with few close relatives, thus preserving more unique evolutionary history.' }
                },
                {
                    id: 'landscape-diversity',
                    title: 'Landscape Diversity',
                    description: 'Diversity at a broad geographic scale.',
                     content: {
                        explanation: 'Landscape diversity, also known as beta-diversity, refers to the variety of different ecosystems within a larger region. A landscape with a mosaic of forests, wetlands, grasslands, and rivers has higher landscape diversity than a region covered by a monoculture of farmland.',
                        visual: 'Forest 🌲 + Wetland 🏞️ + Grassland 🌾 = High Landscape Diversity',
                        example: 'The Greater Yellowstone Ecosystem has high landscape diversity, containing alpine meadows, coniferous forests, hot springs, and sagebrush steppe. This variety of habitats supports a much wider range of species than any single one could alone.'
                     },
                    challenge: { question: 'Which of the following best describes landscape diversity?', options: ['The number of individuals in a landscape', 'The variety of different ecosystems within a larger region', 'The genetic variation of a single species across a landscape', 'The age of the ecosystems in the landscape'], correct: 1, explanation: 'Landscape diversity refers to the variety and spatial arrangement of different ecosystems, such as forests, lakes, and grasslands, across a broad geographic area.' }
                },
                {
                    id: 'cryptic-species',
                    title: 'Cryptic Species',
                    description: 'When appearances are deceiving in species counts.',
                     content: {
                        explanation: 'Cryptic species are two or more distinct species that are classified as a single species because they are morphologically nearly identical. Modern genetic tools have revealed that cryptic species are very common, meaning traditional, morphology-based biodiversity surveys often underestimate the true number of species.',
                        visual: '🦋 = 🦋 (Looks the same) → 🧬 vs 🧬 (Different DNA) → Two Cryptic Species',
                        example: 'The two-barred flasher butterfly in Costa Rica was long thought to be a single species. However, DNA analysis and studies of their caterpillar food sources revealed that it is actually a complex of at least 10 different, genetically distinct species.'
                     },
                    challenge: { question: 'The existence of "cryptic species" (species that look identical but are genetically distinct) poses a challenge primarily to measuring:', options: ['Genetic diversity', 'Species diversity', 'Ecosystem diversity', 'Functional diversity'], correct: 1, explanation: 'Cryptic species lead to underestimates of species diversity (specifically, species richness) because they cannot be distinguished based on morphology alone.' }
                }
            ],
            'measuring-biodiversity': [
                 {
                    id: 'alpha-diversity',
                    title: 'Alpha Diversity',
                    description: 'Measuring diversity within a single habitat or community',
                    content: {
                        explanation: 'Alpha diversity (α-diversity) is the mean species diversity in a site at a local scale. It quantifies the number of species (richness) and their relative abundance (evenness) within a specific, defined area. Think of it as the diversity within a single forest patch, a single lake, or a single coral reef.',
                        visual: '🔍 Single Location → 🦋🐝🐛 Count Species → ⚖️ Measure Evenness → 📊 Alpha Diversity Score',
                        measures: {
                            'Species Richness (S)': {
                                description: 'The simplest measure: a count of the total number of different species present.',
                                formula: 'S = total number of species',
                                whenToUse: 'For quick comparisons or when abundance data is unavailable. It is a fundamental but often incomplete measure.',
                                limitations: 'A community with 10 species where 9 are extremely rare has the same richness as one where all 10 are common.'
                            },
                            'Shannon Index (H\')': {
                                description: 'Quantifies the uncertainty in predicting the species identity of an individual taken at random. It combines richness and evenness, giving more weight to rare species.',
                                formula: "H' = -Σ(pi × ln(pi))",
                                interpretation: 'Where pi is the proportion of individuals belonging to the i-th species. Values typically range from 1.5 (low) to 3.5 (high).',
                                whenToUse: 'A very common, robust index for comparing diversity across communities, especially when you want to account for both richness and evenness.'
                            },
                            'Simpson Index (D)': {
                                description: 'Measures the probability that two individuals randomly selected from a sample will belong to the same species. Often presented as 1-D (Gini-Simpson Index) so that higher values mean higher diversity.',
                                formula: 'D = Σ(pi²), so Gini-Simpson = 1 - Σ(pi²)',
                                interpretation: 'Ranges from 0 (infinite diversity) to 1 (no diversity). The 1-D form ranges from 0 to 1, with 1 being infinite diversity.',
                                whenToUse: 'When you want to give more weight to common or dominant species in the community.'
                            },
                            "Pielou's Evenness Index (J')": {
                                description: 'Measures how close in numbers each species in an environment is. It is calculated by dividing the Shannon Index by the maximum possible diversity for that community.',
                                formula: "J' = H' / H'max = H' / ln(S)",
                                interpretation: 'Ranges from 0 to 1, where 1 represents a situation where all species are equally abundant.',
                                whenToUse: 'To specifically quantify the evenness component of diversity, separating it from the richness component.'
                            }
                        },
                        example: 'Garden A: 90 daisies, 10 roses (S=2, H\'=0.33, J\'=0.48). Garden B: 50 daisies, 50 roses (S=2, H\'=0.69, J\'=1.0). Both have the same richness (S), but Garden B has much higher Shannon diversity and perfect evenness.',
                        limitations: 'Alpha diversity is scale-dependent; the size of the area you define matters. It doesn\'t tell you anything about diversity across a wider landscape or the uniqueness of the species present.'
                    },
                    challenge: { question: 'A forest plot has 5 tree species with counts: [40, 25, 20, 10, 5]. Which index would best capture the fact that one species is very dominant?', options: ['Species Richness (S)', "Shannon Index (H')", "Simpson Index (D)", "Pielou's Evenness (J')"], correct: 2, explanation: "The Simpson Index (D) gives more weight to abundant species. Its formula (Σpi²) will be heavily influenced by the most common species (with proportion 0.4), making it sensitive to dominance." }
                },
                {
                    id: 'beta-diversity',
                    title: 'Beta Diversity',
                    description: 'Measuring how species composition changes between habitats',
                    content: {
                        explanation: 'Beta diversity (β-diversity) measures the change or turnover in species composition between two or more sites. High beta diversity means that the sites have very different species, while low beta diversity means the sites share most of the same species. It is the crucial link between local (alpha) and regional (gamma) diversity.',
                        visual: '🏞️ Site A Species ↔️ Site B Species → 🔄 Compare Composition → 📈 Turnover Score',
                        measures: {
                            "Whittaker's Index (βw)": {
                                description: "The original and most straightforward measure of beta diversity. It relates regional and local diversity.",
                                formula: "βw = γ / α",
                                interpretation: "Where γ (gamma) is the total number of species in the landscape and α (alpha) is the average number of species per site. If every site had the same species, βw = 1. The higher the value, the more turnover between sites.",
                                whenToUse: "For a simple, intuitive measure of turnover across a whole region."
                            },
                            "Jaccard Index (SJ)": {
                                description: "A measure of similarity between two sites based on presence-absence data. It's the size of the intersection divided by the size of the union of the sample sets.",
                                formula: "SJ = |A ∩ B| / |A ∪ B| = c / (a + b - c)",
                                interpretation: "Where 'a' is species in site A, 'b' is species in site B, and 'c' is species shared by both. Ranges from 0 (no shared species) to 1 (identical species). Beta diversity is often expressed as dissimilarity: 1 - SJ.",
                                whenToUse: "When you only have presence-absence data and want to compare pairs of sites."
                            },
                            "Sørensen-Dice Index (QS)": {
                                description: "Similar to Jaccard, but gives more weight to the species that are shared between the two sites.",
                                formula: "QS = 2c / (a + b)",
                                interpretation: "Where 'a', 'b', and 'c' are the same as in Jaccard. It also ranges from 0 to 1. The dissimilarity version (1 - QS) is a common metric for beta diversity.",
                                whenToUse: "When you believe shared species are more informative than unshared species. It's less sensitive to outliers than Jaccard."
                            }
                        },
                        example: 'Lake A has fish [trout, bass, perch]. Lake B has [carp, catfish, perch]. The total species (gamma) is 5. Average alpha is 3. Whittaker\'s Beta = 5/3 ≈ 1.67. For a pairwise comparison, the Jaccard similarity is 1 / (3 + 3 - 1) = 1/5 = 0.2. The dissimilarity is 1 - 0.2 = 0.8, indicating high beta diversity.',
                        limitations: 'Beta diversity is highly dependent on the scale and distance between samples. Different indices can give different results, and many do not account for species abundance, only presence or absence.'
                    },
                    challenge: { question: 'You study insects on two mountains. Mountain A has 100 species. Mountain B has 100 species. A total of 110 unique species are found across both mountains. What does this indicate?', options: ['High beta diversity; the mountains have very different insect communities.', 'Low beta diversity; the mountains share most of their insect species.', 'High gamma diversity, but we cannot determine beta.', 'Low alpha diversity on both mountains.'], correct: 1, explanation: "Low beta diversity. If the communities were very different (high beta), the total species count (gamma) would be closer to 200. Since it's only 110, it means most species (90 of them) are found on both mountains, indicating low turnover and high similarity." }
                },
                {
                    id: 'gamma-diversity',
                    title: 'Gamma Diversity',
                    description: 'The total diversity over a large geographic area or landscape',
                    content: {
                        explanation: 'Gamma diversity (γ-diversity) is the total species diversity across a large area or region. It is a product of the diversity within habitats (alpha) and the differences between habitats (beta). Understanding gamma diversity is essential for conservation planning at landscape scales, as it represents the entire species pool available to colonize local sites.',
                        visual: '🌍 Entire Region (γ) = 🏞️ Avg. Local Diversity (α) x 🔄 Turnover Between Sites (β)',
                        measures: {
                            "Species Inventory": {
                                description: "The most basic measure is simply a complete list of all species found within the defined region. This is the regional species richness.",
                                formula: "γ = Total number of species in the landscape",
                                interpretation: "A larger number indicates a richer species pool for that region.",
                                whenToUse: "When establishing a baseline for conservation or comparing the overall biodiversity of different large-scale regions."
                            },
                            "Multiplicative Partitioning": {
                                description: "This framework shows how alpha, beta, and gamma diversity are mathematically linked, providing a powerful way to understand how diversity is structured across a landscape.",
                                formula: "γ = α * βw",
                                interpretation: "Regional diversity (γ) is the product of mean local diversity (α) and the turnover between sites (Whittaker's β). A region can have high gamma diversity by having very rich local sites (high α) OR by having many distinct, non-overlapping sites (high β), or both.",
                                whenToUse: "To decompose regional diversity and understand whether it is driven more by within-habitat richness or between-habitat differentiation."
                            }
                        },
                        example: 'A mountain range has a gamma diversity of 200 bird species. If the average birds per forest patch (alpha) is 20, then the Whittaker\'s beta diversity is 200 / 20 = 10. This indicates there are effectively 10 distinct bird communities across the mountain range, highlighting high turnover.',
                        limitations: 'Defining the boundaries of a "region" for gamma diversity can be arbitrary and greatly influences the result. A full species inventory is often impossible to obtain, meaning most gamma diversity estimates are based on extrapolation and sampling.'
                    },
                    challenge: { question: 'Two regions, X and Y, both have a gamma diversity of 300 plant species. Region X has high alpha and low beta diversity. Region Y has low alpha and high beta diversity. Which region is more vulnerable to the destruction of a single large habitat patch?', options: ['Region X, because each patch contains a large proportion of the total regional diversity.', 'Region Y, because each patch contains unique species not found elsewhere.', 'Both are equally vulnerable because their gamma diversity is the same.', 'Neither, as long as some habitat remains.'], correct: 1, explanation: 'Region Y is more vulnerable. High beta diversity means each habitat patch holds a unique collection of species. Destroying one patch could cause regional extinction of those unique species. In Region X, the same species are found everywhere (low beta).' }
                },
                {
                    id: 'shannon-interpretation',
                    title: 'Shannon Index Interpretation',
                    description: 'Understanding evenness in communities.',
                    content: {
                        explanation: "Pielou's Evenness Index (J') standardizes the Shannon Index to a value between 0 and 1, making it easier to interpret. A value of 1 means all species are perfectly even in their abundance (e.g., a community with 10 species, each with 10 individuals). A value near 0 indicates that one or a few species are highly dominant. This index allows you to isolate the evenness component from the richness component of diversity.",
                        visual: "H' (Combined Diversity) ÷ ln(S) (Max Possible Diversity) = J' (Pure Evenness)",
                        example: "A rainforest with a J' of 0.9 has very evenly distributed species. A cornfield with a few weed species might have a J' of 0.1, indicating the corn is overwhelmingly dominant, even if several other species are technically present."
                    },
                    challenge: { question: "If Pielou's Evenness Index (J') for a community is close to 1, what does this tell you?", options: ["The community has very few species.", "The community has very high species richness.", "All species in the community have nearly equal abundances.", "One species is highly dominant in the community."], correct: 2, explanation: "Pielou's Evenness (J') ranges from 0 to 1. A value of 1 means the community has perfect evenness, with all species present in equal numbers." }
                },
                {
                    id: 'jaccard-index-use',
                    title: 'Jaccard Index Use',
                     description: 'Comparing sites with presence-absence data.',
                     content: {
                        explanation: "The Jaccard Index is a go-to tool for comparing the species composition of two sites when you only have presence/absence data. You don't need abundance counts, just a list of which species are present. It calculates similarity by dividing the number of shared species by the total number of unique species found across both sites combined. Beta diversity is often expressed as its opposite, Jaccard Dissimilarity (1 - Jaccard Index).",
                        visual: "Shared Species / Total Unique Species = Similarity Score",
                        example: "Site A has birds [Robin, Sparrow, Finch]. Site B has [Sparrow, Crow, Blue Jay]. They share 1 species (Sparrow). The total unique species across both sites is 5 (Robin, Sparrow, Finch, Crow, Blue Jay). The Jaccard similarity is 1/5 = 0.2. The dissimilarity is 1 - 0.2 = 0.8, indicating the bird communities are 80% different."
                    },
                    challenge: { question: 'You have data for two coral reefs. For each reef, you only have a list of species present, not their abundances. Which index is most appropriate for comparing their beta diversity?', options: ['Shannon Index', 'Simpson Index', 'Jaccard Index', 'Pielou\'s Evenness'], correct: 2, explanation: 'The Jaccard Index is specifically designed for presence-absence data, making it ideal for comparing community similarity when you only have lists of species.' }
                },
                {
                    id: 'whittaker-beta',
                    title: 'Whittaker\'s Beta',
                    description: 'Calculating species turnover.',
                     content: {
                        explanation: "Whittaker's Beta (βw) provides a simple, intuitive measure of species turnover across a whole region. It directly links regional diversity (gamma) and local diversity (alpha). The formula is simply gamma divided by the average alpha diversity. The resulting number can be interpreted as the effective number of distinct communities in the landscape.",
                        visual: "Total Regional Species (γ) / Average Local Species (α) = Number of Distinct Communities (βw)",
                        example: "A mountain range (region) has 200 total bird species (gamma). You survey 10 forest patches (local sites) and find an average of 20 bird species per patch (alpha). The Whittaker's Beta is 200 / 20 = 10. This implies there are effectively 10 different, distinct bird communities across the mountain range."
                    },
                    challenge: { question: 'A landscape contains 5 ponds. The total number of fish species across all ponds (gamma) is 20. The average number of species per pond (alpha) is 4. What is the Whittaker\'s Beta (βw) diversity?', options: ['0.2', '4', '5', '80'], correct: 2, explanation: "Whittaker's Beta (βw) is calculated as γ / α. In this case, 20 / 4 = 5. This implies there are effectively 5 distinct fish communities across the ponds." }
                },
                {
                    id: 'scale-dependence',
                    title: 'Scale Dependence',
                    description: 'How study size affects diversity measures.',
                     content: {
                        explanation: "Scale dependence is a fundamental concept in ecology: the patterns you observe depend on the spatial scale of your study. A measure of alpha diversity for a 1-meter plot is different from a 1-hectare plot. Similarly, beta diversity depends on the distance between your samples, and gamma diversity depends on how you define your 'region'. There is no single 'correct' scale; the key is to choose a scale relevant to your question and be consistent.",
                        visual: "🔬 Small Scale (1m²) ≠ 🌳 Medium Scale (1ha) ≠ 🌍 Large Scale (100km²)",
                        example: "If you compare two 1m² plots in a forest, their beta diversity might be very high because one plot happens to have a fern and the other a sapling. If you compare two 1-hectare plots, their beta diversity will be much lower because both will contain a similar mix of ferns, saplings, and mature trees. The pattern of diversity changes with the scale of observation."
                    },
                    challenge: { question: 'The values calculated for alpha, beta, and gamma diversity are highly dependent on:', options: ['The time of day', 'The spatial scale of the study', 'The researcher\'s personal bias', 'The temperature'], correct: 1, explanation: 'All diversity measures are scale-dependent. Defining your "local" site (for alpha) and "regional" area (for gamma) will fundamentally change the results, a key consideration in ecological studies.' }
                },
                {
                    id: 'rarefaction-curve',
                    title: 'Rarefaction Curve',
                    description: 'Comparing richness between unequal samples.',
                     content: {
                        explanation: "Rarefaction is a statistical method used to address a common problem: how to compare the species richness of two samples of unequal size. A larger sample will almost always contain more species just by chance. Rarefaction curves solve this by plotting the expected number of species as a function of sampling effort (number of individuals). This allows you to compare richness at a standardized sample size.",
                        visual: "📈 Samples of different sizes → 📉 Standardize to common sample size → 📊 Fair comparison",
                        example: "You collect 500 insects from Forest A and find 50 species. You collect 100 insects from Forest B and find 30 species. Is Forest A richer? Rarefaction calculates the expected number of species you would have found in Forest A if you had only collected 100 insects. If that number is, say, 25, then Forest B is actually richer for a given sample size."
                    },
                    challenge: { question: 'What is the primary purpose of a rarefaction curve in biodiversity measurement?', options: ['To estimate the total population size of a species', 'To compare species richness between samples of unequal sizes', 'To calculate the exact beta diversity between two sites', 'To determine the genetic diversity of a population'], correct: 1, explanation: 'Rarefaction allows you to fairly compare the species richness of samples that have different numbers of individuals by plotting the expected number of species as a function of sample size.' }
                },
                {
                    id: 'alpha-gamma-relationship',
                    title: 'Alpha and Gamma Relationship',
                    description: 'Linking local and regional diversity.',
                     content: {
                        explanation: "Alpha, beta, and gamma diversity are intrinsically linked. The total diversity of a region (gamma) is a product of the average diversity found at local sites (alpha) and the differentiation among those sites (beta). A region can achieve high gamma diversity in two ways: either by having very rich local sites (high alpha, low beta) or by having many ecologically distinct sites that each contain a unique set of species (low alpha, high beta).",
                        visual: "γ (Regional) = α (Local) x β (Turnover)",
                        example: "A tropical lowland (high alpha, low beta) might have many species in every patch. A mountain range (low alpha, high beta) might have fewer species at any given elevation, but the total species count is high because each elevation band has a different set of species."
                    },
                    challenge: { question: 'If a large region has very high gamma diversity but all local sites within it have low alpha diversity, what must be true?', options: ['The region must have low beta diversity.', 'The region must have high beta diversity.', 'The sampling must have been done incorrectly.', 'The region is likely a desert or polar environment.'], correct: 1, explanation: 'For gamma (regional) diversity to be high when alpha (local) diversity is low, there must be a high turnover of species between sites. This means beta diversity is high.' }
                },
                {
                    id: 'abundance-data',
                    title: 'Importance of Abundance Data',
                    description: 'Why evenness matters.',
                     content: {
                        explanation: "While simply counting the number of species (richness) is useful, it provides an incomplete picture. Abundance data—information on the relative numbers of individuals per species—is crucial for understanding community structure. Indices like Shannon and Simpson incorporate abundance, giving a more nuanced view of diversity. A community dominated by one or two species functions very differently from one where many species are equally common.",
                        visual: "[10, 10, 10] vs. [28, 1, 1] → Same Richness, Different Diversity",
                        example: "Two forests both contain 10 tree species. Forest A has 10 individuals of each species. Forest B has 91 individuals of one species and 1 individual of each of the other nine. They have the same species richness (S=10), but Forest A is far more diverse because it has high evenness. The Simpson and Shannon indices would capture this difference, while a simple richness count would not."
                    },
                    challenge: { question: 'The Shannon and Simpson indices are considered more informative than species richness (S) because they:', options: ['Are easier to calculate', 'Work for any type of organism', 'Incorporate both richness and evenness (abundance)', 'Can predict future extinctions'], correct: 2, explanation: 'Species richness only counts the number of species, while the Shannon and Simpson indices incorporate the relative abundance (evenness) of those species, providing a more complete picture of community structure.' }
                }
            ],
            'ecosystem-services': [
                 {
                    id: 'provisioning-services',
                    title: 'Provisioning Services',
                    description: 'Resources that ecosystems provide directly',
                    content: {
                        explanation: 'Provisioning services are the products we get directly from ecosystems. These include food, fresh water, timber, fiber, and medicines. Biodiversity supports these services by providing genetic resources for crops, maintaining soil health for agriculture, and ensuring clean water through natural filtering processes.',
                        visual: '🌾 Food → 💧 Fresh Water → 🌲 Timber → 💊 Medicine → 🏠 Human Benefits',
                        example: 'A single bee colony can pollinate crops worth thousands of dollars annually. Tropical rainforests provide over 25% of modern medicines. Wetlands filter billions of gallons of water naturally, saving communities millions in water treatment costs.',
                        limitations: 'Challenges include: (1) These services are often taken for granted until lost, (2) Economic value is hard to calculate precisely, (3) Overuse can damage the ecosystems providing them, (4) Climate change is reducing reliability.'
                    },
                    challenge: { question: 'A farming community relies on forests for clean water and bees for crop pollination. Developers want to cut down the forest. What is the best argument for keeping it?', options: ['The forest looks beautiful', 'The forest provides essential services worth thousands of dollars annually', 'Forests are always more important than development', 'The forest might contain rare species'], correct: 1, explanation: 'The economic value of provisioning services (clean water, pollination) is often the most compelling argument, as it provides measurable benefits to the community.' }
                },
                {
                    id: 'regulating-services',
                    title: 'Regulating Services',
                    description: 'How ecosystems control environmental conditions',
                    content: {
                        explanation: 'Regulating services are the ways ecosystems control environmental conditions that affect human well-being. These include climate regulation, water purification, disease control, and protection from natural disasters.',
                        visual: '🌡️ Climate Control → 🌊 Water Filtering → 🦠 Disease Control → 🛡️ Storm Protection → 🏘️ Human Safety',
                        example: 'Forests cool local temperatures and absorb carbon dioxide. Wetlands prevent flooding by soaking up excess water during storms. Predators control pest populations that would otherwise damage crops.',
                        limitations: 'Challenges include: (1) Services operate at large scales making them hard to manage locally, (2) Benefits may not be obvious until ecosystems are damaged, (3) Multiple ecosystems may be needed to provide one service.'
                    },
                    challenge: { question: 'A coastal city can build sea walls or restore coastal wetlands to protect against storms. Which provides more regulating services?', options: ['Sea walls - they provide guaranteed protection', 'Wetland restoration - provides storm protection plus other benefits', 'Both are equal', 'Neither - rising seas will overwhelm any protection'], correct: 1, explanation: 'Wetland restoration provides multiple regulating services: storm surge protection, flood control, water filtration, carbon storage, and nursery habitat for fish.' }
                },
                {
                    id: 'cultural-services',
                    title: 'Cultural Services',
                    description: 'Non-material benefits from ecosystems',
                    content: {
                        explanation: 'Cultural services are the non-material benefits people derive from ecosystems through spiritual enrichment, recreation, and aesthetic experiences. Biodiversity enhances these services by providing beautiful landscapes and connections to nature that support human mental and spiritual well-being.',
                        visual: '🎨 Beauty → 🧘 Spiritual Value → 🏃 Recreation → 📚 Education → 💭 Mental Health',
                        example: 'National parks attract millions of visitors who find peace in natural settings. Birdwatching contributes billions to local economies. Urban green spaces reduce stress and improve mental health for city residents.',
                        limitations: 'Challenges include: (1) Cultural values vary greatly between different groups, (2) These services are difficult to measure economically, (3) Access to nature is often unequal across communities.'
                    },
                    challenge: { question: 'A city must choose between a waterfront park or a shopping complex. How would you argue for the park using cultural services?', options: ['Parks provide jobs for gardeners', 'Shopping complexes harm the environment', 'Parks offer recreation, education, beauty, and mental health benefits', 'Parks cost less to build'], correct: 2, explanation: 'Cultural services provide multiple non-material benefits that improve quality of life: recreational opportunities, educational experiences, aesthetic beauty, and stress reduction.' }
                },
                {
                    id: 'supporting-services',
                    title: 'Supporting Services',
                    description: 'The foundational services for all others.',
                     content: {
                        explanation: 'Supporting services are the fundamental ecological processes that are necessary for the production of all other ecosystem services. They are the "behind-the-scenes" work of nature that allows everything else to function. You don\'t consume them directly, but without them, no other services would exist.',
                        visual: '🌱 Photosynthesis → 💧 Water Cycle → ♻️ Nutrient Cycling → 🌳 Soil Formation',
                        example: 'Soil formation by microorganisms and weathering of rock can take centuries, but it is the essential supporting service that enables provisioning services (food, timber), regulating services (water filtration), and cultural services (parks). Without soil formation, there would be no agriculture or forests.'
                     },
                    challenge: { question: 'Which of the following is the best example of a supporting ecosystem service?', options: ['Timber from a forest', 'Flood control by a wetland', 'Nutrient cycling in the soil', 'Hiking in a national park'], correct: 2, explanation: 'Supporting services are the fundamental processes necessary for all other ecosystem services. Nutrient cycling, soil formation, and primary production are key examples.' }
                },
                {
                    id: 'pollination-service',
                    title: 'Pollination Service',
                    description: 'A crucial service for agriculture.',
                    content: {
                        explanation: 'Pollination, the transfer of pollen between flowers, is essential for the reproduction of over 85% of the world\'s flowering plants, including more than two-thirds of the world\'s crop species. This service, primarily performed by animals like bees, butterflies, birds, and bats, is considered a regulating service because it controls a fundamental biological process.',
                        visual: "🐝 Pollinator → 🌸 Flower → 🍎 Fruit/Seed → 🍽️ Food Production",
                        example: "The value of pollination by bees for almond crops in California is estimated at over $4 billion per year. Without the managed transport of honeybee hives to the almond groves each spring, the industry would collapse, demonstrating a direct link between a regulating service and a provisioning service (food)."
                    },
                    challenge: { question: 'The service of pollination by bees, bats, and other animals, which is crucial for agriculture, is classified as what type of service?', options: ['Provisioning service', 'Regulating service', 'Cultural service', 'Supporting service'], correct: 1, explanation: 'Pollination is considered a regulating service because it regulates the process of plant reproduction, which is vital for crop production and ecosystem health.' }
                },
                {
                    id: 'carbon-sequestration',
                    title: 'Carbon Sequestration',
                    description: 'How ecosystems regulate climate.',
                    content: {
                        explanation: 'Carbon sequestration is the process by which ecosystems capture and store atmospheric carbon dioxide (CO2). This is a critical regulating service that helps to mitigate climate change. Forests, oceans, and soils are the world\'s largest carbon sinks. Photosynthesis pulls CO2 out of the air, and it is then stored in wood, roots, and organic matter in the soil.',
                        visual: "💨 Atmospheric CO₂ → 🌲 Photosynthesis → 🌳 Stored in Biomass/Soils",
                        example: "The Amazon rainforest is estimated to store between 150 and 200 billion metric tons of carbon, which is more than a decade's worth of global greenhouse gas emissions. Protecting and restoring forests is one of the most effective natural climate solutions available."
                    },
                    challenge: { question: 'Forests and oceans absorbing vast amounts of CO2 from the atmosphere is a critical example of which type of service?', options: ['Global climate regulation', 'Water purification', 'Pest control', 'Provisioning of food'], correct: 0, explanation: 'The absorption and storage of carbon is a key regulating service that helps control global climate.' }
                },
                {
                    id: 'service-valuation',
                    title: 'Service Valuation',
                    description: 'The challenge of pricing nature.',
                    content: {
                        explanation: "Ecosystem service valuation is the process of assigning an economic value to the benefits provided by nature. This is challenging because many services, like clean air or a stable climate, are 'public goods' not traded in traditional markets. Methods include estimating replacement costs (e.g., cost of building a water treatment plant vs. protecting a wetland) or surveying people's willingness-to-pay.",
                        visual: "🌳 Nature's Benefit → 🤔 How much is it worth? → 💰 Assigning a $ Value",
                        example: "New York City invested $1.5 billion to protect the Catskill Mountains watershed that provides its drinking water. This was seen as a bargain compared to the estimated $8-10 billion cost to build a new water filtration plant, plus $300 million in annual operating costs. This is an example of using 'replacement cost' to value a service."
                    },
                    challenge: { question: 'Why is it often difficult to assign an economic value to ecosystem services?', options: ['They have no real value to the economy', 'Their benefits are often public goods and not traded in markets', 'Technology can replace all of them easily', 'They only benefit wildlife, not people'], correct: 1, explanation: 'Many services, like clean air or a stable climate, are "public goods" without a market price, making their immense value difficult to quantify in traditional economic terms.' }
                },
                {
                    id: 'biodiversity-service-link',
                    title: 'Biodiversity & Services Link',
                    description: 'Why diversity is the foundation of services.',
                    content: {
                        explanation: "Biodiversity is the engine that provides ecosystem services. A more diverse ecosystem is often more productive, stable, and resilient. Different species perform different roles (functional diversity), and having multiple species that perform the same role (functional redundancy) provides insurance if one is lost. Therefore, losing biodiversity can degrade and destabilize the services we rely on.",
                        visual: "🦋🐛🐜 (Biodiversity) → ⚙️ (Ecosystem Function) → 💧🍎 (Services)",
                        example: "Studies in grasslands have shown that plots with higher plant diversity are more resistant to drought. Different species have different root depths and water-use strategies, so even when some species suffer, others can compensate, maintaining overall productivity (a supporting service) and grazing quality (a provisioning service)."
                    },
                    challenge: { question: 'What is the primary relationship between biodiversity and ecosystem services?', options: ['They are unrelated concepts', 'Higher biodiversity generally enhances and stabilizes the provision of ecosystem services', 'Higher biodiversity always decreases the provision of services', 'Only a few key species provide all services'], correct: 1, explanation: 'Biodiversity is the foundation of ecosystem services. A more diverse ecosystem is often more resilient and efficient at providing services like water purification, pollination, and pest control.' }
                },
                {
                    id: 'water-purification',
                    title: 'Water Purification',
                    description: 'Nature\'s filtration system.',
                    content: {
                        explanation: "Water purification is a regulating service where ecosystems naturally filter pollutants, excess nutrients, and sediments from water. Wetlands are particularly effective, acting like natural kidneys for the landscape. Plant roots trap sediment, while microorganisms break down pollutants and absorb nutrients, resulting in cleaner water downstream.",
                        visual: "🚱 Dirty Water → [🏞️ Wetland Filter] → 💧 Clean Water",
                        example: "The Congaree National Park in South Carolina contains a floodplain forest that filters and purifies water from the Congaree and Wateree Rivers. This service has been valued at over $5 million per year, providing cleaner water for downstream communities and ecosystems at no cost."
                    },
                    challenge: { question: 'Wetlands, forests, and soils naturally filter pollutants and excess nutrients from water. This is an example of a:', options: ['Provisioning service', 'Regulating service', 'Cultural service', 'Supporting service'], correct: 1, explanation: 'Water purification is a classic example of a regulating service, where the ecosystem controls and mitigates pollutants, improving water quality for downstream users.' }
                },
                {
                    id: 'ecotourism',
                    title: 'Ecotourism',
                    description: 'The economic value of natural beauty.',
                    content: {
                        explanation: "Ecotourism is a form of tourism centered on visiting natural, often protected, areas. It is a prime example of a cultural service that also provides direct economic benefits. It relies on the aesthetic beauty, recreational opportunities, and educational value of healthy ecosystems and charismatic wildlife. When managed properly, it can provide a powerful economic incentive for conservation.",
                        visual: "🐒 Pristine Nature →  पर्यटकों Tourist → 💰 Local Income → 🛡️ Incentive to Protect",
                        example: "Gorilla trekking in Rwanda is a world-famous ecotourism success story. Tourists pay high fees to see mountain gorillas in their natural habitat. This generates millions of dollars annually, funding national park protection and providing jobs for local communities, turning former poachers into dedicated conservationists."
                    },
                    challenge: { question: 'The revenue generated from tourists visiting a pristine coral reef for scuba diving falls under which category of ecosystem service?', options: ['Provisioning service', 'Regulating service', 'Cultural service', 'Supporting service'], correct: 2, explanation: 'Ecotourism, recreation, and aesthetic enjoyment are all key cultural services that provide non-material benefits and economic opportunities based on the health and beauty of ecosystems.' }
                }
            ],
            'evolutionary-processes': [
                 {
                    id: 'speciation',
                    title: 'Speciation',
                    description: 'How new species form.',
                    content: {
                        explanation: 'Speciation is the evolutionary process by which new biological species arise. It occurs when populations become reproductively isolated and diverge genetically over time. Think of it like languages evolving - Spanish, French, and Italian all came from Latin, but separated communities developed different languages until speakers could no longer understand each other.',
                        visual: '🦎 Ancestral Population → 🏔️ Geographic Barrier → ⏰ Time + Mutations → 🦎🦖 Two New Species',
                        example: 'Darwin\'s finches in the Galápagos Islands exemplify adaptive radiation - one ancestral finch species colonized different islands and evolved into 18 distinct species with different beak shapes adapted to different food sources. Islands with hard seeds have finches with strong, thick beaks, while islands with nectar-producing flowers have finches with long, thin beaks.',
                        limitations: 'Speciation challenges: (1) It usually takes thousands to millions of years to observe directly, (2) The boundary between species can be fuzzy - ring species and hybrid zones blur the lines, (3) Different species concepts (biological, morphological, genetic) may give different answers, (4) Speciation rates vary dramatically among groups.'
                    },
                    challenge: { question: 'A river changes course, dividing a butterfly population. After 10,000 years, they look slightly different but can still interbreed in a lab. Have they speciated?', options: ['Yes - they look different', 'No - they can still interbreed', 'They are in the process of speciation but not complete', 'Yes - they have been separated long enough'], correct: 2, explanation: 'This represents incomplete speciation. The populations show divergence but maintain reproductive compatibility. Speciation is a gradual process, not an instant event.' }
                },
                {
                    id: 'extinction',
                    title: 'Extinction',
                    description: 'The permanent loss of species.',
                    content: {
                        explanation: 'Extinction is the termination of a species when the last individual dies. It\'s a natural part of evolution - 99% of all species that ever lived are now extinct. However, human activities have increased extinction rates 100-1000 times above natural background rates. Extinction is forever - once a species is gone, its unique evolutionary history and ecological role are lost permanently.',
                        visual: '📉 Population Decline → ⚠️ Critical Numbers → 🚫 Last Individual Dies → ❌ Extinction',
                        example: 'The passenger pigeon went from being the most abundant bird in North America (3-5 billion individuals) to extinction in just 50 years due to hunting and habitat loss. The last passenger pigeon, Martha, died in Cincinnati Zoo in 1914. This shows how even super-abundant species can go extinct rapidly.',
                        limitations: 'Extinction challenges: (1) We often don\'t know a species is extinct until years after the last individual dies, (2) "Lazarus species" thought extinct are sometimes rediscovered, (3) Functional extinction (too few to maintain population) occurs before actual extinction, (4) Extinction debt means species may be "living dead" - doomed but still present.'
                    },
                    challenge: { question: 'An island has 50 bird species. Rats are introduced. After 20 years, 40 species remain but all have declining populations. What concept best describes this?', options: ['Mass extinction event', 'Extinction debt', 'Natural selection', 'Adaptive radiation'], correct: 1, explanation: 'This illustrates extinction debt - the future extinctions that will occur due to events that already happened. Even if rats were removed, small population sizes would likely lead to more extinctions.' }
                },
                {
                    id: 'adaptation',
                    title: 'Adaptation',
                    description: 'Evolution in response to the environment.',
                    content: {
                        explanation: 'Adaptation is the evolutionary process where organisms become better suited to their environment through natural selection. Beneficial traits that improve survival and reproduction become more common over generations. It\'s important to remember that adaptation is not purposeful - organisms don\'t "try" to adapt, rather beneficial random mutations are selected for over time.',
                        visual: '🦋 Variation → 🌍 Environmental Pressure → ✨ Natural Selection → 🎯 Adapted Population',
                        example: 'The peppered moth in England evolved from light-colored to dark-colored during the Industrial Revolution as pollution darkened tree bark. Light moths became easy prey on dark trees. After pollution controls, the population evolved back to light coloration as trees became cleaner. This rapid adaptation occurred over just 50 years.',
                        limitations: 'Adaptation limitations: (1) Evolution can only work with existing genetic variation, (2) Trade-offs mean improving one trait often worsens another, (3) Environmental change may occur faster than adaptation, (4) Historical constraints limit possible adaptations - evolution modifies what exists rather than designing from scratch.'
                    },
                    challenge: { question: 'Climate change warms a mountain. A plant there could move upslope, evolve heat tolerance, or go extinct. What determines the outcome?', options: ['Only its genetic variation for heat tolerance', 'Only the rate of temperature change', 'The combination of genetic variation, dispersal ability, and rate of change', 'Random chance alone'], correct: 2, explanation: 'All three factors interact: genetic variation determines evolutionary potential, dispersal ability affects migration possibility, and the rate of change determines if there\'s enough time to adapt or move.' }
                },
                {
                    id: 'allopatric-speciation',
                    title: 'Allopatric Speciation',
                    description: 'Speciation by geographic separation.',
                     content: {
                        explanation: 'Allopatric speciation is the most common form of speciation, occurring when a population is divided by a geographic barrier (like a mountain range, river, or ocean). Once separated, the two populations can no longer interbreed (no gene flow). They evolve independently through mutation, natural selection, and genetic drift, eventually becoming so different that they can no longer reproduce even if they come back into contact.',
                        visual: 'Population 🦎 → 🏔️ Barrier Forms → 🦎 evolves one way, 🦎 evolves another → 🦎 & 🦖 are now separate species',
                        example: "The formation of the Isthmus of Panama about 3 million years ago separated the Pacific and Atlantic oceans. This isolated many marine populations, such as snapping shrimp. Over time, the isolated populations evolved into distinct 'sister species' on either side of the isthmus, a classic example of allopatric speciation."
                    },
                    challenge: { question: 'The formation of the Grand Canyon separated a squirrel population, leading to the evolution of two distinct species on the north and south rims. This is a classic example of:', options: ['Sympatric speciation', 'Allopatric speciation', 'Parapatric speciation', 'Artificial selection'], correct: 1, explanation: 'Allopatric speciation occurs when a population is divided by a geographic barrier, leading to reproductive isolation and divergence into new species.' }
                },
                {
                    id: 'adaptive-radiation',
                    title: 'Adaptive Radiation',
                    description: 'Rapid diversification from a single ancestor.',
                     content: {
                        explanation: 'Adaptive radiation is the rapid evolution of many diverse species from a single common ancestor. This often occurs when a species colonizes a new environment with many unoccupied ecological niches, or following a mass extinction that clears out competitors. The ancestral species diversifies to fill these available roles, often leading to a wide array of forms and functions.',
                        visual: 'Ancestor 🐦 → 🏝️ New Islands/Niches → 🐦(eats seeds) 🐦(eats insects) 🐦(eats nectar) → Many new species',
                        example: "Darwin's finches in the Galápagos are the textbook example. An ancestral finch species arrived on the islands and diversified into at least 14 different species, each with a specialized beak adapted for a different food source—from cracking hard seeds to probing for insects in wood. This allowed them to exploit all available food resources."
                    },
                    challenge: { question: 'The rapid evolution of many diverse species from a single common ancestor, like Darwin\'s finches in the Galápagos, is known as:', options: ['Genetic drift', 'A population bottleneck', 'Adaptive radiation', 'Stabilizing selection'], correct: 2, explanation: 'Adaptive radiation is the diversification of a group of organisms into forms filling different ecological niches, often occurring when a new habitat opens up.' }
                },
                {
                    id: 'natural-selection',
                    title: 'Natural Selection',
                    description: 'The mechanism of adaptive evolution.',
                     content: {
                        explanation: 'Natural selection is the primary mechanism of adaptive evolution. It is the process by which individuals with heritable traits better suited to their environment tend to survive and reproduce at higher rates than other individuals. This causes those advantageous traits to become more common in the population over generations. It requires three ingredients: variation, heritability, and differential survival/reproduction.',
                        visual: 'Variation (🔴🔵) + Heritability 👪 + Selection ( predators eat 🔴) = Adaptation (more 🔵)',
                        example: "The evolution of antibiotic resistance in bacteria. When an antibiotic is applied, most bacteria are killed, but a few may have a random mutation that allows them to survive. These resistant bacteria then reproduce, passing the resistance trait to their offspring. Over time, the entire population becomes resistant to the antibiotic."
                    },
                    challenge: { question: 'Which of the following is NOT a necessary condition for evolution by natural selection?', options: ['Variation in traits within a population', 'Traits are heritable', 'All individuals in the population must reproduce', 'Variation in survival and reproduction (fitness)'], correct: 2, explanation: 'Natural selection requires that not all individuals survive and reproduce equally; there must be differential success for selection to occur. The other three are necessary conditions.' }
                },
                {
                    id: 'mass-extinction',
                    title: 'Mass Extinction',
                    description: 'Catastrophic loss of global biodiversity.',
                     content: {
                        explanation: "A mass extinction is a widespread and rapid decrease in the biodiversity on Earth. It is defined as an event where at least 75% of all species go extinct in a geologically short period (less than 2.8 million years). There have been five major mass extinctions in Earth's history, the most famous being the event that wiped out the dinosaurs. Many scientists believe we are currently in a sixth mass extinction, driven by human activities.",
                        visual: '💥 Catastrophic Event → 📉 75%+ of Species Disappear → 🌍 New Evolutionary Trajectory',
                        example: "The Cretaceous-Paleogene extinction event, 66 million years ago, was caused by a massive asteroid impact. It led to the extinction of about 76% of all species, including all non-avian dinosaurs. This event paved the way for the adaptive radiation of mammals, who were able to move into the ecological niches left vacant."
                    },
                    challenge: { question: 'What distinguishes a mass extinction event from background extinction?', options: ['Mass extinctions only affect dinosaurs', 'The rate of extinction is significantly higher than the background rate', 'Mass extinctions are always caused by asteroids', 'Background extinction is caused by humans'], correct: 1, explanation: 'Mass extinctions are periods of Earth\'s history when a large proportion of all species go extinct in a geologically short time, far exceeding the normal background rate.' }
                },
                {
                    id: 'evolutionary-trade-off',
                    title: 'Evolutionary Trade-Off',
                    description: 'When an adaptation has costs and benefits.',
                     content: {
                        explanation: "An evolutionary trade-off occurs when an adaptation that improves fitness in one context does so at the cost of decreased fitness in another context. Organisms cannot be perfectly adapted for all situations at once. Selection favors a compromise that provides the best overall fitness in a given environment. There is no 'free lunch' in evolution.",
                        visual: "Trait A: 👍 Survival, 👎 Reproduction | Trait B: 👎 Survival, 👍 Reproduction → Natural selection finds a balance.",
                        example: "A male peacock's large, colorful tail is a result of sexual selection and increases its chances of mating (a benefit). However, the same tail is energetically expensive to produce and makes the peacock more visible to predators and slower to escape (a cost). The tail's evolution represents a trade-off between reproductive success and survival."
                    },
                    challenge: { question: 'A male peacock\'s large, colorful tail attracts mates but also makes it easier for predators to spot. This is a classic example of:', options: ['A vestigial trait', 'An evolutionary trade-off', 'A neutral mutation', 'Convergent evolution'], correct: 1, explanation: 'An evolutionary trade-off occurs when a trait that increases fitness in one way (e.g., reproduction) decreases fitness in another way (e.g., survival).' }
                },
                {
                    id: 'sympatric-speciation',
                    title: 'Sympatric Speciation',
                    description: 'Speciation without geographic barriers.',
                     content: {
                        explanation: "Sympatric speciation is the evolution of a new species from an ancestral species while both continue to inhabit the same geographic region. It occurs without any physical barrier separating the populations. Instead, reproductive isolation evolves through other means, such as shifts in habitat preference (e.g., specializing on a new host plant) or genetic changes like polyploidy (having more than two sets of chromosomes).",
                        visual: '🍎 Maggot flies on apples | 🌿 Maggot flies on hawthorns → Mate on preferred fruit → Eventually become two species in the same orchard',
                        example: "The apple maggot fly, *Rhagoletis pomonella*, originally laid its eggs only on hawthorn fruits. When apple trees were introduced to North America, some flies began laying eggs on apples instead. Now, the two groups have genetically diverged and are in the process of becoming distinct species, despite living side-by-side."
                    },
                    challenge: { question: 'Speciation that occurs without any geographic barrier, often due to polyploidy in plants or host shifts in insects, is called:', options: ['Allopatric speciation', 'Peripatric speciation', 'Sympatric speciation', 'Biogeographic speciation'], correct: 2, explanation: 'Sympatric speciation is the evolution of a new species from a surviving ancestral species while both continue to inhabit the same geographic region.' }
                },
                {
                    id: 'sexual-selection',
                    title: 'Sexual Selection',
                    description: 'Selection for traits that increase mating success.',
                     content: {
                        explanation: "Sexual selection is a specific type of natural selection where fitness is determined by mating success. It drives the evolution of traits that help an organism attract mates (intersexual selection, or 'female choice') or compete with rivals for access to mates (intrasexual selection, or 'male-male competition'). It can lead to extravagant and seemingly non-adaptive traits.",
                        visual: "🦚 Elaborate Tail → More Mates | 🦌 Large Antlers → Win Fights → More Mates",
                        example: "The massive antlers of a male moose are a product of sexual selection. They are used in combat with other males to gain access to females (intrasexual selection). Females may also prefer males with larger antlers as an honest signal of their health and genetic quality (intersexual selection). These antlers are costly to grow and carry, representing a trade-off with survival."
                    },
                    challenge: { question: 'The evolution of elaborate courtship displays or physical traits (like antlers on a deer) is often driven by what specific type of natural selection?', options: ['Directional selection', 'Stabilizing selection', 'Disruptive selection', 'Sexual selection'], correct: 3, explanation: 'Sexual selection is a mode of natural selection where members of one biological sex choose mates of the other sex to mate with (intersexual selection) and compete with members of the same sex for access to members of the opposite sex (intrasexual selection).' }
                }
            ],
            'ecological-processes': [
                 {
                    id: 'community-assembly',
                    title: 'Community Assembly',
                    description: 'How ecological communities form.',
                    content: {
                        explanation: 'Community assembly describes how ecological communities come together from a regional species pool. It\'s like forming a sports team - not all available players make the roster. Species must first arrive (dispersal), then survive the environment (environmental filtering), and finally coexist with other species (biotic interactions). The order of arrival often matters greatly.',
                        visual: '🌍 Regional Species Pool → 🚀 Dispersal → 🌡️ Environmental Filter → 🤝 Species Interactions → 🏘️ Local Community',
                        example: 'After Mount St. Helens erupted in 1980, the blast zone was sterilized. Pioneer species like lupines arrived first, fixing nitrogen and creating soil. This allowed grasses, then shrubs, then trees to establish. Early arrivers changed conditions for later species. Today\'s community was shaped by this assembly history.',
                        limitations: 'Assembly challenges: (1) Historical contingency means small early differences lead to different outcomes, (2) Priority effects mean arrival order matters as much as species traits, (3) Communities may have multiple stable states, (4) Human activities have broken natural dispersal barriers, creating novel communities.'
                    },
                    challenge: { question: 'Two identical ponds are created. Pond A is colonized by algae, then small fish, then predatory fish. Pond B gets predators first. What is the likely outcome?', options: ['Both ponds will develop identical communities', 'Different communities will form due to priority effects', 'Pond B will have no fish', 'Only pond A will develop a community'], correct: 1, explanation: 'Priority effects (the impact of a species\' arrival on subsequent colonization) will create different communities. In Pond B, predators arriving without prey will fundamentally alter the assembly trajectory.' }
                },
                {
                    id: 'biogeography',
                    title: 'Biogeography',
                    description: 'The spatial patterns of life.',
                    content: {
                        explanation: 'Biogeography studies the distribution of species across space and time. It explains why kangaroos are only in Australia, why islands have unique species, and why tropical regions have more species than polar regions. Geographic barriers, climate, geological history, and evolution all influence where species are found.',
                        visual: '🗺️ Geographic Space → 🏔️ Barriers & Corridors → 🌡️ Climate Zones → 🕰️ Evolutionary Time → 📍 Species Distributions',
                        example: 'Wallace\'s Line in Indonesia marks a sharp boundary between Asian and Australian fauna despite similar climates on both sides. West of the line: tigers, rhinos, orangutans. East of the line: kangaroos, cockatoos, marsupials. This invisible line represents an ancient deep-water barrier that prevented species mixing even during ice ages when sea levels were lower.',
                        limitations: 'Biogeography limitations: (1) Human transportation has scrambled natural patterns through introduced species, (2) Climate change is shifting ranges faster than we can document them, (3) Fossil records are incomplete, making historical reconstructions uncertain, (4) Microorganism distributions are poorly understood.'
                    },
                    challenge: { question: 'An island 100km from the mainland has fewer species than the mainland, but those species are found nowhere else (endemic). What explains this?', options: ['Islands are too small to support many species', 'Island isolation limits colonization but promotes unique evolution', 'Island climates are unsuitable for mainland species', 'Islands sink over time'], correct: 1, explanation: 'Island biogeography theory explains this: isolation limits new arrivals (fewer species) but populations that do establish evolve in isolation, becoming endemic.' }
                },
                {
                    id: 'metapopulations',
                    title: 'Metapopulations',
                    description: 'Networks of interconnected populations.',
                    content: {
                        explanation: 'A metapopulation is a group of spatially separated populations of the same species that interact through dispersal. Think of it like a network of coffee shops - each location may occasionally close or reopen, but the chain persists as long as some shops remain to reestablish failed locations. This concept is crucial for understanding species persistence in fragmented landscapes.',
                        visual: '🏝️ Patch 1 → ↔️ Migration → 🏝️ Patch 2 → ↔️ Migration → 🏝️ Patch 3 → 🔄 Extinction/Colonization',
                        example: 'The Bay checkerspot butterfly in California exists as a metapopulation across serpentine soil patches. Individual populations regularly go extinct during droughts, but the species persists because butterflies from surviving populations recolonize empty patches. Habitat connectivity is crucial - if patches become too isolated, recolonization fails and the metapopulation collapses.',
                        limitations: 'Metapopulation challenges: (1) Assumes distinct habitat patches, but boundaries are often gradual, (2) Requires balance of local extinction and colonization rates, (3) Habitat fragmentation may exceed dispersal ability, (4) Small populations may lose genetic diversity before rescue arrives.'
                    },
                    challenge: { question: 'A plant exists in 10 meadows. A highway removes 3 but 3 new ones are created elsewhere. Why might this still threaten the metapopulation?', options: ['Total number of meadows is the same, so no threat', 'New meadows may lack proper soil', 'Spatial arrangement matters - new meadows might be too isolated', 'Plants cannot adapt to human habitats'], correct: 2, explanation: 'Metapopulation persistence depends on connectivity. If new meadows are beyond dispersal distance, they cannot be colonized, and the remaining meadows may become too isolated to rescue each other.' }
                },
                {
                    id: 'succession',
                    title: 'Ecological Succession',
                    description: 'Community change over time.',
                    content: {
                        explanation: 'Ecological succession is the process of change in species composition over time. Primary succession starts with bare rock or soil (like after a volcanic eruption), while secondary succession occurs after disturbance of existing communities (like after a forest fire). Early pioneer species modify the environment, making it suitable for later species in predictable stages.',
                        visual: '🌋 Bare Ground → 🌱 Pioneer Species → 🌿 Intermediate Species → 🌳 Climax Community → ⚡ Disturbance → 🔄 Repeat',
                        example: 'After glaciers retreat in Alaska, the exposed rock is first colonized by lichens and mosses. These break down rock into soil. Then herbs like fireweed establish, followed by shrubs like alder that fix nitrogen. Eventually spruce forests develop. This primary succession takes about 200 years from bare rock to mature forest.',
                        limitations: 'Succession limitations: (1) The "climax community" concept is outdated - communities continue changing, (2) Disturbance regimes often prevent reaching late stages, (3) Climate change means historical patterns may not predict future succession, (4) Multiple pathways can lead to different "stable" states.'
                    },
                    challenge: { question: 'An abandoned farm field becomes a forest over 50 years. This is secondary succession. What would make it primary succession?', options: ['If it took longer than 100 years', 'If it started from bare rock with no soil or seeds', 'If different species colonized the field', 'If humans planted the trees'], correct: 1, explanation: 'Primary succession begins with no soil or organisms present (e.g., bare rock). Secondary succession starts with soil and a seed bank already present, like an abandoned field.' }
                },
                {
                    id: 'keystone-species',
                    title: 'Keystone Species',
                     description: 'Species with a disproportionately large effect.',
                     content: {
                        explanation: 'A keystone species is a species that has a disproportionately large effect on its ecosystem relative to its abundance or biomass. Like the keystone in a stone arch, its removal can cause the entire structure to collapse. Keystone species often maintain biodiversity by controlling populations of otherwise dominant species.',
                        visual: 'Keystone (⭐️) → Holds Community (🧱🧱🧱) Together',
                        example: 'Sea otters in the North Pacific are a classic keystone species. They eat sea urchins. Without otters, sea urchin populations explode and graze down kelp forests, creating "urchin barrens" that support very few other species. By controlling urchins, a small number of otters maintain the entire kelp forest ecosystem and its high biodiversity.'
                    },
                    challenge: { question: 'A species that has a disproportionately large effect on its environment relative to its abundance is called a:', options: ['Dominant species', 'Indicator species', 'Foundation species', 'Keystone species'], correct: 3, explanation: 'A keystone species, like a sea otter in a kelp forest, plays a critical role in maintaining the structure of an ecological community.' }
                },
                {
                    id: 'island-biogeography-theory',
                    title: 'Island Biogeography Theory',
                    description: 'Predicting diversity on islands.',
                     content: {
                        explanation: "The Theory of Island Biogeography, developed by Robert MacArthur and E.O. Wilson, proposes that the number of species on an island is a dynamic balance between immigration of new species and extinction of resident species. It predicts that large islands close to the mainland will have the highest biodiversity, while small, isolated islands will have the lowest.",
                        visual: '(⬆️ Immigration) vs. (⬇️ Extinction) → Equilibrium Number of Species',
                        example: "The island of Krakatoa was sterilized by a volcanic eruption in 1883. Scientists documented its recolonization. As predicted, species richness increased rapidly at first and then slowed as immigration rates decreased and extinction rates increased. Islands closer to the mainland (Java, Sumatra) were the primary source of colonists."
                    },
                    challenge: { question: 'According to the theory of island biogeography, which type of island would you expect to have the highest species richness?', options: ['A large island far from the mainland', 'A small island close to the mainland', 'A large island close to the mainland', 'A small island far from the mainland'], correct: 2, explanation: 'Large islands provide bigger targets and more resources (lower extinction), while close islands are easier to colonize (higher immigration). Both factors lead to higher species richness.' }
                },
                {
                    id: 'trophic-cascade',
                    title: 'Trophic Cascade',
                    description: 'Indirect effects across food web levels.',
                     content: {
                        explanation: 'A trophic cascade is a powerful indirect interaction that can control an entire ecosystem. It occurs when a predator suppresses the abundance of its prey (the next level down in the food web), which in turn releases the next lower trophic level from predation or herbivory. Cascades can be top-down (predator controls ecosystem) or bottom-up (resources control ecosystem).',
                        visual: '🐺 (Predator) → 📉 (Herbivore) → 📈 (Plant) → Ecosystem Change',
                        example: "The reintroduction of wolves to Yellowstone National Park is a famous example. Wolves (predator) reduced the number and changed the behavior of elk (herbivore). With less browsing pressure from elk, willow and aspen trees (plants) began to recover along rivers. This, in turn, created habitat for beavers and songbirds, demonstrating how a single predator can restructure an entire ecosystem."
                    },
                    challenge: { question: 'When the removal of a top predator leads to dramatic changes in the ecosystem, such as an increase in herbivores and a decrease in plants, this is called a:', options: ['Competitive exclusion', 'Resource partitioning', 'A trophic cascade', 'Ecological succession'], correct: 2, explanation: 'Trophic cascades are powerful indirect interactions that can control entire ecosystems, occurring when a trophic level in a food web is suppressed.' }
                },
                {
                    id: 'niche-construction',
                    title: 'Niche Construction',
                    description: 'How organisms modify their own environment.',
                     content: {
                        explanation: "Niche construction is the process whereby organisms, through their activities and choices, modify their own and each other's environments. This changes the selection pressures on the population. It highlights that organisms are not just passive recipients of environmental pressures; they are active agents that shape their own evolutionary trajectories. Species that significantly modify their habitat are also called 'ecosystem engineers'.",
                        visual: 'Organism  beaver → Builds Dam → Creates Wetland → Changes Selection Pressures',
                        example: "Beavers are master ecosystem engineers. By cutting down trees and building dams, they transform a stream into a pond and wetland. This fundamentally alters the habitat, creating new niches for fish, amphibians, insects, and waterfowl, while eliminating niches for species adapted to fast-flowing streams. The beaver actively constructs its own preferred niche."
                    },
                    challenge: { question: 'Beavers building dams, which creates a new wetland habitat for many other species, is a prime example of:', options: ['A keystone species', 'Niche construction', 'A trophic cascade', 'All of the above'], correct: 3, explanation: 'Beavers are a classic example of all three. They are a keystone species whose niche construction (building dams) creates a trophic cascade by altering the entire ecosystem.' }
                },
                {
                    id: 'intermediate-disturbance',
                    title: 'Intermediate Disturbance',
                    description: 'How disturbance levels can maximize diversity.',
                     content: {
                        explanation: 'The Intermediate Disturbance Hypothesis (IDH) proposes that biodiversity will be highest at intermediate levels of disturbance. At low levels of disturbance, a few strong competitors will dominate and exclude other species. At high levels of disturbance, only a few highly resilient or fast-colonizing species can survive. Intermediate levels prevent competitive exclusion while also allowing more species to persist.',
                        visual: 'Low Disturbance (📉 Diversity) | High Disturbance (📉 Diversity) | Medium Disturbance (📈 Peak Diversity)',
                        example: "In intertidal boulder fields, small boulders are frequently overturned by waves (high disturbance), supporting few species. Large boulders are rarely overturned (low disturbance) and become dominated by a few superior competitors like mussels. Intermediate-sized boulders, which are overturned occasionally, support the highest diversity of algae and invertebrates."
                    },
                    challenge: { question: 'The Intermediate Disturbance Hypothesis suggests that biodiversity is highest when disturbances are:', options: ['Very frequent and intense', 'Very infrequent and mild', 'At an intermediate level of frequency and intensity', 'Completely absent'], correct: 2, explanation: 'This hypothesis proposes that high levels of disturbance exclude slow-growing species, and low levels allow competitive dominants to exclude others. Intermediate levels allow for the highest diversity.' }
                },
                {
                    id: 'environmental-filtering',
                    title: 'Environmental Filtering',
                    description: 'How the environment selects for certain traits.',
                     content: {
                        explanation: "Environmental filtering is a key process in community assembly. It describes how abiotic (non-living) environmental conditions—such as temperature, water availability, soil pH, or salinity—act as a 'filter', allowing only species with specific traits to survive and become part of a local community. It's the first hurdle a species must pass to join a community, even before it interacts with other species.",
                        visual: "Regional Species Pool [🌵🌲❄️] → 🔥 Hot, Dry Environment → [🌵] Local Community",
                        example: "A desert environment exerts a strong environmental filter. From the regional pool of all possible plant species, only those with traits for drought tolerance (like deep roots, waxy leaves, or water-storing stems) can pass through the filter and establish a population. Species adapted to wet conditions are 'filtered out'."
                    },
                    challenge: { question: 'In the process of community assembly, what is "environmental filtering"?', options: ['The process of cleaning pollutants from the environment', 'The inability of species to colonize a new area due to dispersal barriers', 'The process by which only species with suitable adaptations to the local environment can survive', 'Competition between species for limited resources'], correct: 2, explanation: 'Environmental filtering is a "sieve" that allows only species with specific traits (e.g., drought tolerance, cold hardiness) to become part of a local community based on the abiotic conditions.' }
                }
            ],
            'species-interactions': [
                {
                    id: 'competition',
                    title: 'Competition',
                    description: 'The struggle for limited resources.',
                    content: {
                        explanation: 'Competition occurs when species use the same limited resources, reducing fitness for both. Competitive exclusion principle states that complete competitors cannot coexist - one will outcompete the other. However, species often evolve resource partitioning (using resources differently) to minimize competition and allow coexistence. Competition drives much of evolution and community structure.',
                        visual: '🦓🦌 Same Resources → ⚔️ Competition → 📊 Fitness Costs → 🔄 Exclusion or Partitioning',
                        example: 'MacArthur\'s warblers: Five warbler species feed on insects in the same spruce trees but minimize competition by foraging in different parts of the tree. Cape May warblers feed at the top, Bay-breasted warblers in the middle interior, and Yellow-rumped warblers on lower branches. This resource partitioning allows coexistence.',
                        limitations: 'Competition limitations: (1) Proving competition requires difficult removal experiments, (2) Past "ghost of competition past" may be more important than current competition, (3) Environmental variation may prevent competitive exclusion, (4) Facilitation may be more common than competition in harsh environments.'
                    },
                    challenge: { question: 'Two lizard species eat the same insects. On islands where both occur, one evolves a longer jaw for larger insects, the other a shorter jaw for smaller insects. What is this?', options: ['Competitive exclusion', 'Character displacement', 'Predator avoidance', 'Random genetic drift'], correct: 1, explanation: 'This is character displacement - evolutionary divergence in competing species where they co-occur. By evolving to use different resources, they reduce competition and can coexist.' }
                },
                {
                    id: 'predation',
                    title: 'Predation & Herbivory',
                    description: 'Eating and being eaten.',
                    content: {
                        explanation: 'Predation (animals eating animals) and herbivory (animals eating plants) are fundamental interactions where one species benefits by consuming another. These interactions drive evolution of defenses (toxins, camouflage, armor) and counter-adaptations (detoxification, better detection). Predators can maintain diversity by preventing competitive exclusion among prey species.',
                        visual: '🦁 Predator → 🦓 Prey → 💀 Selection Pressure → 🛡️ Defense Evolution → 🎯 Counter-adaptation',
                        example: 'Sea otters eating sea urchins maintain kelp forests. Without otters, urchins overgraze kelp, creating "urchin barrens." This shows how predation has cascading effects - otters are a keystone species whose predation structures the entire ecosystem. Their local extinction led to kelp forest collapse along much of the Pacific coast.',
                        limitations: 'Predation study challenges: (1) Indirect effects through behavior (fear) may be stronger than direct killing, (2) Predator-prey cycles are often unpredictable in nature, (3) Multiple predators create complex, non-additive effects, (4) Climate change is disrupting predator-prey phenology matching.'
                    },
                    challenge: { question: 'Introducing wolves to Yellowstone led to healthier riverside vegetation. How did predation cause this?', options: ['Wolf droppings fertilized plants', 'Wolves scared elk away from riversides, reducing browsing', 'Wolves brought seeds', 'Dead elk carcasses enriched soils'], correct: 1, explanation: 'This "ecology of fear" is a behaviorally-mediated trophic cascade. Elk avoided risky riverside areas, allowing willows and aspens to recover from over-browsing.' }
                },
                {
                    id: 'mutualism',
                    title: 'Mutualism',
                    description: 'Cooperative interactions in nature.',
                    content: {
                        explanation: 'Mutualism is a win-win interaction where both species benefit. Examples include pollination (bees and flowers), seed dispersal (birds and fruits), and protection (ants and acacia trees). Many mutualisms are essential for ecosystem functioning. However, mutualisms can be unstable - partners may "cheat" by taking benefits without providing services.',
                        visual: '🐝 Partner A Benefit → 🔄 Service Exchange → 🌺 Partner B Benefit → ✅ Both Win',
                        example: 'Mycorrhizal fungi form mutualistic relationships with 80% of plant species. Fungi provide plants with nutrients (especially phosphorus) and water in exchange for sugars from photosynthesis. This ancient partnership allowed plants to colonize land 400 million years ago and remains essential for most plant growth today.',
                        limitations: 'Mutualism challenges: (1) Context-dependency - mutualisms can become parasitic under different conditions, (2) Cheating can destabilize partnerships, (3) Partner specificity versus generalization trade-offs, (4) Climate change may disrupt synchronized timing between partners.'
                    },
                    challenge: { question: 'Cleaner fish eat parasites off larger fish. Sometimes they "cheat" by eating mucus. What keeps this mutualism stable?', options: ['Larger fish tolerate cheating', 'Cleaner fish never cheat', 'Client fish remember and avoid cheaters, selecting for honesty', 'The relationship is actually parasitism'], correct: 2, explanation: 'Partner choice maintains cooperation. Client fish observe and avoid cleaners that cheat, creating a reputation-based system that selects for cooperative behavior.' }
                },
                {
                    id: 'food-webs',
                    title: 'Food Webs',
                    description: 'The network of feeding relationships.',
                    content: {
                        explanation: 'Food webs map who eats whom in ecological communities, showing how energy and nutrients flow through ecosystems. They reveal emergent properties like trophic levels, keystone species, and cascading effects. Real food webs are complex networks with omnivory, cannibalism, and changing interactions, not simple chains.',
                        visual: '🌱 Producers → 🐛 Herbivores → 🐦 Predators → 🦅 Top Predators → 🔄 Decomposers',
                        example: 'Removing sea stars from rocky intertidal zones causes mussel populations to explode, crowding out other species and reducing diversity from 15 to 1 species. This revealed sea stars as keystone predators - their feeding maintains community diversity by preventing competitive exclusion. Their importance in the food web far exceeds their biomass.',
                        limitations: 'Food web limitations: (1) Difficult to observe all feeding links, especially for small or cryptic species, (2) Interaction strength varies temporally, (3) Non-feeding interactions (competition, facilitation) also matter, (4) Omnivory makes discrete trophic levels unrealistic.'
                    },
                    challenge: { question: 'A lake food web is algae -> zooplankton -> small fish -> large fish. Overfishing removes large fish. What is the most likely cascade effect?', options: ['Algae decrease', 'Small fish increase, zooplankton decrease, algae increase', 'All populations remain stable', 'Zooplankton increase'], correct: 1, explanation: 'This is a trophic cascade. Removing top predators (large fish) releases their prey (small fish) from predation. More small fish eat more zooplankton, which in turn releases algae from grazing pressure.' }
                },
                {
                    id: 'commensalism',
                    title: 'Commensalism',
                    description: 'A +/0 interaction.',
                     content: {
                        explanation: "Commensalism is a type of relationship between two species where one species benefits while the other is neither harmed nor helped. It is a '+/0' interaction. This can be challenging to prove, as it's difficult to be certain the 'unaffected' species truly experiences no effect at all.",
                        visual: 'Species A 🙂 + Species B 😐 = Commensalism',
                        example: "Cattle egrets are birds that follow livestock like cattle or elephants. As the large animals walk through grass, they stir up insects, which the egrets then eat. The egrets get an easy meal (a benefit), while the cattle are generally unaffected by the birds' presence."
                    },
                    challenge: { question: 'An orchid growing on a tree branch, gaining access to sunlight without harming or helping the tree, is an example of what interaction?', options: ['Mutualism', 'Parasitism', 'Commensalism', 'Amensalism'], correct: 2, explanation: 'Commensalism is a +/0 interaction where one species benefits and the other is unaffected. The orchid benefits from a place to grow, and the tree is not significantly affected.' }
                },
                {
                    id: 'competitive-exclusion-principle',
                    title: 'Competitive Exclusion',
                    description: 'Why two species can\'t share the same niche.',
                     content: {
                        explanation: "The Competitive Exclusion Principle, also known as Gause's Law, states that two species competing for the exact same limited resources cannot coexist in the same place at constant population values. When one species has even a slight advantage over another, the one with the advantage will dominate in the long run. The other species will either be driven to extinction or undergo an evolutionary or behavioral shift toward a different ecological niche.",
                        visual: 'Species 1 & 2 want same 🍕 → Species 1 is better at getting 🍕 → Species 2 eventually disappears',
                        example: "In a classic experiment, the scientist G.F. Gause grew two species of *Paramecium* separately and together. When grown alone, both species thrived. When grown together in the same container with a limited food source, one species, *P. aurelia*, always outcompeted and eliminated the other, *P. caudatum*."
                    },
                    challenge: { question: 'The Competitive Exclusion Principle states that two species cannot coexist indefinitely if they:', options: ['Are in a predator-prey relationship', 'Occupy the exact same niche', 'Are both part of a mutualism', 'Live in different habitats'], correct: 1, explanation: 'Also known as Gause\'s Law, this principle states that two species competing for the same limiting resources cannot coexist at constant population values, if other ecological factors remain constant.' }
                },
                {
                    id: 'resource-partitioning',
                    title: 'Resource Partitioning',
                    description: 'How species avoid competition.',
                     content: {
                        explanation: "Resource partitioning is the division of limited resources by species to help avoid competition in an ecological niche. By using different resources, or using the same resources at different times or in different ways, species can coexist where they might otherwise be driven to extinction by competition. It's a way of 'sharing' the environment.",
                        visual: 'Two birds, one tree 🌳 → Bird 1 eats on top branches, Bird 2 on bottom → Competition avoided',
                        example: "Five species of warblers studied by Robert MacArthur all live in the same spruce trees and eat insects. They avoid competition by partitioning their foraging habitat: each species feeds in a different part of the tree. For instance, the Cape May warbler forages at the very top, while the Yellow-rumped warbler forages at the bottom."
                    },
                    challenge: { question: 'Several species of warblers foraging for insects in different parts of the same tree is a classic example of:', options: ['Competitive exclusion', 'A trophic cascade', 'Resource partitioning', 'A mutualism'], correct: 2, explanation: 'Resource partitioning is the division of limited resources by species to help avoid competition in an ecological niche. This allows them to coexist.' }
                },
                {
                    id: 'amensalism',
                    title: 'Amensalism',
                    description: 'A -/0 interaction.',
                     content: {
                        explanation: "Amensalism is a relationship between two species in which one is inhibited or destroyed while the other is unaffected. It's a '-/0' interaction. This often happens by accident, such as when a larger or stronger organism harms a smaller or weaker one without intending to.",
                        visual: 'Species A 😠 + Species B 😐 = Amensalism',
                        example: "The black walnut tree produces a chemical called juglone, which is toxic to many other plants and prevents them from growing near its roots. The walnut tree harms nearby plants (a negative effect), but the walnut tree itself is not affected by this interaction."
                    },
                    challenge: { question: 'A large tree shades out a small seedling, preventing its growth, while the tree itself is unaffected. This is an example of what type of interaction?', options: ['Competition (-/-)', 'Parasitism (+/-)', 'Commensalism (+/0)', 'Amensalism (-/0)'], correct: 3, explanation: 'Amensalism is a -/0 interaction where one organism is harmed while the other is unaffected. The seedling is harmed by the lack of light, but the large tree is not affected.' }
                },
                {
                    id: 'batesian-mimicry',
                    title: 'Batesian Mimicry',
                    description: 'When the harmless mimics the harmful.',
                     content: {
                        explanation: "Batesian mimicry is a form of mimicry where a harmless species has evolved to imitate the warning signals of a harmful species directed at a common predator. The mimic gains protection because predators mistake it for the dangerous species and avoid it. It's essentially a form of 'bluffing' or 'false advertising' in nature.",
                        visual: '🐍 Venomous snake (Model) → 🐍 Harmless snake (Mimic) → 🦅 Predator avoids both',
                        example: "The non-venomous king snake has red, yellow, and black bands similar to the highly venomous coral snake. Predators that have learned to avoid the deadly coral snake will also avoid the harmless king snake, granting it protection. This mimicry only works if the mimic is less common than the model."
                    },
                    challenge: { question: 'The non-venomous king snake has coloration similar to the venomous coral snake. This is an example of:', options: ['Müllerian mimicry', 'Camouflage', 'Aposematism', 'Batesian mimicry'], correct: 3, explanation: 'Batesian mimicry is when a harmless species evolves to imitate the warning signals of a harmful species directed at a predator of them both.' }
                },
                {
                    id: 'mullerian-mimicry',
                    title: 'Müllerian Mimicry',
                    description: 'When two harmful species mimic each other.',
                     content: {
                        explanation: "Müllerian mimicry is a natural phenomenon in which two or more well-defended species, often foul-tasting or venomous, have come to mimic each other's honest warning signals, such as conspicuous color patterns. This is a form of 'mutual benefit', as predators only need to learn one warning signal to avoid all the mimic species. This reinforces the signal and shares the cost of educating predators.",
                        visual: '🐝 Wasp (stings) + 🦋 Butterfly (toxic) → Both evolve same warning colors → 🐦 Predator learns faster to avoid both',
                        example: "Many species of stinging bees and wasps share a similar black and yellow striped pattern. A predator that has a bad experience with one species (e.g., a wasp) will learn to avoid all other species with that same pattern, including different types of bees. This shared warning system benefits all participating species."
                    },
                    challenge: { question: 'Several species of stinging wasps and bees have evolved similar black and yellow warning patterns. This is an example of:', options: ['Batesian mimicry', 'Müllerian mimicry', 'Crypsis', 'Commensalism'], correct: 1, explanation: 'Müllerian mimicry is a natural phenomenon in which two or more well-defended species, often foul-tasting and sharing common predators, have come to mimic each other\'s honest warning signals.' }
                }
            ],
            'human-impacts': [
                 {
                    id: 'habitat-loss',
                    title: 'Habitat Loss & Fragmentation',
                    description: 'The primary threat to biodiversity.',
                    content: {
                        explanation: 'Habitat loss is the single greatest threat to biodiversity globally. When natural habitats are converted to agriculture, urban areas, or other human uses, species lose their homes. It\'s not just about total area lost - fragmentation divides remaining habitat into smaller, isolated patches that may be too small to sustain populations.',
                        visual: '🌳 Original Habitat → 🚜 Human Conversion → 🏘️ Development → 🌲🏢🌲 Fragmentation → ❌ Local Extinctions',
                        example: 'The Atlantic Forest in Brazil has lost 88% of its original area, with remaining forest fragmented into over 245,000 pieces. Average fragment size is just 64 hectares. This fragmentation has pushed 60% of endemic species toward extinction, including golden lion tamarins and three-toed sloths that cannot cross open areas between forest patches.',
                        limitations: 'Habitat loss complexities: (1) Effects have time lags - extinctions occur decades after habitat loss, (2) Edge effects mean habitat quality degrades beyond just area lost, (3) Different species need different minimum habitat sizes, (4) Some species actually benefit from moderate disturbance.'
                    },
                    challenge: { question: 'A 10,000ha forest will be developed. Option A: Clear 5,000ha from one side. Option B: Build a highway through the middle, destroying only 100ha. Which is worse?', options: ['Option A - it destroys more area', 'Option B - fragmentation effects exceed direct habitat loss', 'Both are equally bad', 'Neither is significant'], correct: 1, explanation: 'Option B is often worse. The highway creates a barrier, increases edge effects, and facilitates invasive species. Fragmentation effects often exceed the impact of direct habitat loss.' }
                },
                {
                    id: 'climate-change',
                    title: 'Climate Change',
                    description: 'The accelerating global crisis.',
                    content: {
                        explanation: 'Climate change affects biodiversity through temperature shifts, altered precipitation, extreme weather, and sea level rise. Species must adapt, migrate, or face extinction. Many cannot move fast enough or have nowhere to go. Climate change also disrupts timing of ecological events like migration and breeding, breaking apart co-evolved relationships.',
                        visual: '🌡️ Temperature Rise → 🗺️ Range Shifts → ⏰ Phenology Mismatches → 🌊 Habitat Changes → 💔 Relationship Disruption',
                        example: 'Polar bears depend on sea ice for hunting seals. Arctic warming has reduced summer ice by 13% per decade. Bears must swim longer distances (up to 400 miles) between ice floes, causing exhaustion and drowning. Cubs survival rates have dropped 50%. By 2050, two-thirds of polar bears may disappear.',
                        limitations: 'Climate impact uncertainties: (1) Species responses are highly variable and hard to predict, (2) Evolutionary adaptation potential is unknown for most species, (3) Interactions between climate change and other threats create surprises, (4) Tipping points and ecosystem collapse thresholds are unclear.'
                    },
                    challenge: { question: 'Mountain plants can respond to warming by moving upslope. What makes this a limited solution?', options: ['Plants cannot move', 'Mountain tops are a dead end - species run out of habitat', 'Higher elevations have more predators', 'Soil quality improves with elevation'], correct: 1, explanation: 'This is the "escalator to extinction" - species moving upslope eventually run out of mountain. High-elevation specialists have nowhere to go when their habitat warms.' }
                },
                {
                    id: 'invasive-species',
                    title: 'Invasive Species',
                    description: 'Non-native species that cause harm.',
                    content: {
                        explanation: 'Invasive species are non-natives that spread rapidly and cause ecological or economic harm. They often lack natural predators, competitors, or diseases in new ranges. Invasives can outcompete natives, prey on species that lack defenses, alter habitats, and introduce diseases. Globalization has accelerated invasions through trade and travel.',
                        visual: '✈️ Human Transport → 🌍 New Environment → 🚫 No Natural Controls → 📈 Population Explosion → 🏚️ Native Species Decline',
                        example: 'Burmese pythons in the Florida Everglades, released from the pet trade, have caused 90-99% declines in medium-sized mammals. A single python can eat a whole deer. With no natural predators and ideal climate, the population has exploded to possibly 100,000+ individuals. They\'ve fundamentally altered the Everglades food web.',
                        limitations: 'Invasion complexities: (1) Only ~1% of introduced species become invasive - predicting which is difficult, (2) Some non-natives integrate without harm or even provide benefits, (3) Eradication is often impossible once established, (4) Climate change is making new areas suitable for invasives.'
                    },
                    challenge: { question: 'Zebra mussels invaded the Great Lakes and made the water crystal clear. Why are they considered harmful?', options: ['Clear water looks unnatural', 'They over-filter, removing food and disrupting the food web', 'Their shells are sharp', 'They are not harmful'], correct: 1, explanation: 'Zebra mussels filter out phytoplankton that native species depend on, collapsing food webs from the bottom up. Clear water indicates ecosystem disruption.' }
                },
                {
                    id: 'pollution',
                    title: 'Pollution',
                    description: 'Chemical and physical contaminants.',
                    content: {
                        explanation: 'Pollution includes chemicals, plastics, nutrients, light, and noise that harm biodiversity. Pesticides kill non-target species, plastics entangle and poison wildlife, nutrient pollution causes dead zones, and pharmaceuticals alter animal behavior. Many pollutants bioaccumulate, concentrating up food chains to dangerous levels in top predators.',
                        visual: '🏭 Pollution Source → 💧 Environmental Spread → 🐟 Bioaccumulation → 🦅 Biomagnification → ☠️ Population Effects',
                        example: 'DDT pesticide nearly drove bald eagles extinct. DDT accumulated up the food chain: water (0.00005 ppm) → plankton (0.04 ppm) → fish (2 ppm) → eagles (25 ppm). High DDT levels caused thin eggshells that broke during incubation. Eagle populations crashed 90% before DDT was banned.',
                        limitations: 'Pollution challenges: (1) Cocktail effects - multiple pollutants interact unpredictably, (2) Sublethal effects on behavior and reproduction are hard to detect, (3) Legacy pollutants persist for decades after bans, (4) Emerging contaminants like microplastics have unknown long-term effects.'
                    },
                    challenge: { question: 'Agricultural runoff causes algal blooms, which die and decompose, using up oxygen. Why is this considered pollution?', options: ['Algae are always toxic', 'Excess nutrients accelerate natural processes beyond ecosystem tolerance', 'Green water is unpleasant', 'It is not pollution since nutrients are natural'], correct: 1, explanation: 'Nutrient pollution (eutrophication) overloads natural cycles. When the algae die, decomposition depletes oxygen, creating "dead zones" where aquatic life cannot survive.' }
                },
                {
                    id: 'overexploitation',
                    title: 'Overexploitation',
                    description: 'Harvesting species unsustainably.',
                    content: {
                        explanation: 'Overexploitation occurs when species are harvested faster than they can reproduce. This includes overfishing, hunting, logging, and collecting for trade. Modern technology allows industrial-scale extraction that can quickly deplete populations. Even sustainable-seeming harvest can become overexploitation if environments change or multiple threats combine.',
                        visual: '🎣 Harvest Rate → ⚖️ > Reproduction Rate → 📉 Population Decline → 🔄 Allee Effect → ⚰️ Extinction',
                        example: 'Atlantic cod supported centuries of fishing until industrial trawling began. The population crashed 99% by 1992, forcing fishery closure. Despite 30 years of protection, cod haven\'t recovered - the ecosystem shifted to a new state dominated by lobsters and other invertebrates. This shows how overexploitation can cause irreversible ecosystem changes.',
                        limitations: 'Exploitation complexities: (1) Maximum sustainable yield calculations often overestimate resilience, (2) Illegal harvest is difficult to quantify or control, (3) Market dynamics create perverse incentives - rarity increases value, (4) Cultural traditions conflict with conservation needs.'
                    },
                    challenge: { question: 'A tropical hardwood tree takes 80 years to mature. Loggers claim planting two saplings for every tree cut is sustainable. What is the flaw?', options: ['Saplings always die', 'Timber value will decrease', 'Time scales don\'t match - harvest is faster than replacement', 'Tropical trees cannot be replanted'], correct: 2, explanation: 'The critical flaw is the temporal mismatch. It takes 80 years to replace what is removed today. This depletes the mature population faster than it can be replaced.' }
                },
                {
                    id: 'biomagnification',
                    title: 'Biomagnification',
                    description: 'How toxins concentrate up the food chain.',
                     content: {
                        explanation: 'Biomagnification is the increasing concentration of persistent toxins in the tissues of organisms at successively higher levels in a food chain. While an organism might absorb a small amount of a toxin (bioaccumulation), that toxin becomes more concentrated at each trophic level because the biomass at each level is produced from a much larger biomass from the level below.',
                        visual: 'Plankton (1 unit toxin) → Small fish (10 units) → Large fish (100 units) → Eagle (1000 units)',
                        example: "The pesticide DDT provides a classic example. It washed into waterways in low concentrations, was absorbed by plankton, and then concentrated up the food chain. By the time it reached top predators like bald eagles and ospreys, the DDT concentrations were high enough to cause their eggshells to become thin and break during incubation, leading to massive population declines."
                    },
                    challenge: { question: 'The process by which toxins like DDT become more concentrated in organisms at higher trophic levels is called:', options: ['Bioaccumulation', 'Eutrophication', 'Biomagnification', 'Acidification'], correct: 2, explanation: 'Biomagnification (or bioamplification) is the increasing concentration of a substance in the tissues of organisms at successively higher levels in a food chain.' }
                },
                {
                    id: 'ocean-acidification',
                    title: 'Ocean Acidification',
                    description: 'The other CO2 problem.',
                     content: {
                        explanation: "Ocean acidification is the ongoing decrease in the pH of the Earth's oceans, caused by the uptake of carbon dioxide (CO2) from the atmosphere. About a quarter of the CO2 we release is absorbed by the ocean, where it reacts with seawater to form carbonic acid. This process lowers the pH (making the water more acidic) and reduces the availability of carbonate ions, which many marine organisms need to build their shells and skeletons.",
                        visual: 'Atmospheric CO₂ → 🌊 Ocean Absorption → H₂CO₃ (Carbonic Acid) → 📉 Lower pH → 🐚 Shells Dissolve',
                        example: "Coral reefs are severely threatened by ocean acidification. The lower concentration of carbonate ions makes it metabolically costly for corals to build their calcium carbonate skeletons. In more acidic conditions, existing coral skeletons can even begin to dissolve. This threatens the survival of the entire reef ecosystem, which provides habitat for 25% of all marine species."
                    },
                    challenge: { question: 'What is the primary cause of ocean acidification, which threatens corals and shellfish?', options: ['Oil spills', 'Plastic pollution', 'The ocean absorbing atmospheric CO2', 'Overfishing'], correct: 2, explanation: 'When the ocean absorbs excess carbon dioxide (CO2) from the atmosphere, it forms carbonic acid, which lowers the pH of the seawater and makes it harder for organisms to build shells.' }
                },
                {
                    id: 'edge-effects',
                    title: 'Edge Effects',
                    description: 'The impacts of habitat boundaries.',
                     content: {
                        explanation: "Edge effects are the changes in population or community structures that occur at the boundary of two or more habitats. When a habitat is fragmented, it creates more 'edge'. These edges have different environmental conditions (e.g., more light, wind, and lower humidity) than the interior 'core' habitat. These changes can negatively impact species adapted to the interior and favor generalist or invasive species.",
                        visual: '🌳 Forest → | Edge (hot, windy, high predation) | → 🌾 Field',
                        example: "In a fragmented rainforest, the forest edge experiences higher temperatures and is more susceptible to fire. It is also more easily invaded by non-native plants from surrounding agricultural land. Bird species that nest on the ground suffer much higher predation rates from predators like raccoons and cats that thrive in the mixed human-forest landscape near the edge."
                    },
                    challenge: { question: 'Habitat fragmentation increases the amount of "edge" habitat. What is a common edge effect?', options: ['Increased biodiversity in the center of the fragment', 'Higher humidity and lower temperatures at the edge', 'Increased predation and invasion by weedy species at the edge', 'Decreased wind and light at the edge'], correct: 2, explanation: 'Edges of habitat fragments are exposed to different conditions, often leading to increased light, wind, predation, and invasion by species from surrounding disturbed areas.' }
                },
                {
                    id: 'bycatch',
                    title: 'Bycatch',
                    description: 'Unintentional capture in fisheries.',
                     content: {
                        explanation: "Bycatch refers to the fish, marine mammals, sea turtles, seabirds, and other animals that are unintentionally caught by commercial fisheries while they are targeting a different species. Many fishing methods, like longlines and bottom trawls, are not selective and capture huge amounts of non-target species. Most bycatch is thrown back into the ocean, but the vast majority are already dead or dying.",
                        visual: '🎣 Fishing for Tuna → Nets also catch 🐢🐬🦈 → Bycatch',
                        example: "Shrimp trawling has one of the highest bycatch rates. For every one pound of shrimp caught, it is estimated that up to six pounds of other species, including juvenile fish, crabs, and sea turtles, are caught and discarded as bycatch. This represents a massive waste of marine life and harms the overall ecosystem."
                    },
                    challenge: { question: 'The unintentional capture of non-target species like dolphins, sea turtles, and seabirds in fishing nets is a major threat known as:', options: ['Overfishing', 'Bycatch', 'Aquaculture', 'Ghost fishing'], correct: 1, explanation: 'Bycatch is a significant problem in global fisheries, leading to the decline of many marine populations that are not the primary target of the fishing effort.' }
                },
                {
                    id: 'light-pollution',
                    title: 'Light Pollution',
                    description: 'How artificial light harms wildlife.',
                     content: {
                        explanation: "Light pollution is the excessive or misdirected use of artificial light at night. It can disrupt the natural patterns of wildlife, affecting migration, reproduction, and feeding. For nocturnal animals, artificial light can be confusing and disorienting, effectively turning their habitat into a less suitable environment. It alters the natural light cycles that many species have evolved to rely on.",
                        visual: '🐢 Hatchling sees 🌕 Moon on water → Goes to ocean | 🐢 Hatchling sees 💡 City lights → Goes inland',
                        example: "Sea turtle hatchlings emerge from their nests on beaches at night and use the bright horizon over the ocean to find their way to the water. Artificial lights from coastal development can disorient them, causing them to move inland where they often die from dehydration or predation. This is a major threat to sea turtle survival."
                    },
                    challenge: { question: 'How can artificial light at night negatively impact biodiversity?', options: ['It helps nocturnal predators hunt more effectively', 'It disrupts the migration of birds and the reproduction of sea turtles', 'It encourages plant growth 24/7', 'It has no significant impact on wildlife'], correct: 1, explanation: 'Artificial light can disorient nocturnally migrating birds, causing them to collide with buildings, and can confuse sea turtle hatchlings, leading them away from the ocean.' }
                }
            ],
            'conservation-biology': [
                 {
                    id: 'protected-areas',
                    title: 'Protected Areas',
                    description: 'Designing and managing reserves.',
                    content: {
                        explanation: 'Protected areas are designated spaces where human activities are limited to conserve biodiversity. Design principles include: bigger is better (supports larger populations), connected is better (allows gene flow), and core areas need buffer zones. However, just 15.7% of land and 7.7% of oceans are protected, and many parks exist only on paper.',
                        visual: '🏞️ Core Area → 🌳 Buffer Zone → 🔗 Wildlife Corridors → 🌐 Reserve Network → 🛡️ Biodiversity Protection',
                        example: 'Yellowstone to Yukon (Y2Y) initiative connects protected areas across 3,200 km from Yellowstone to Yukon. Wildlife overpasses and underpasses allow animals to cross highways safely. This connectivity allows grizzly bears, wolves, and wolverines to maintain genetic diversity across their range. Camera traps have documented thousands of successful crossings.',
                        limitations: 'Protected area challenges: (1) Most reserves are too small and isolated for large species, (2) Climate change shifts species out of fixed reserve boundaries, (3) Human-wildlife conflict at edges creates backlash, (4) Enforcement is often inadequate, making "paper parks" that exist only legally.'
                    },
                    challenge: { question: 'You have funds to protect 1000 km². Option A: One large 1000 km² reserve. Option B: Ten 100 km² reserves. Which is generally better?', options: ['Option B - protects more habitat types', 'Option A - supports bigger populations and area-sensitive species', 'Both are equal', 'Option B - provides backup if one reserve fails'], correct: 1, explanation: 'The Single Large or Several Small (SLOSS) debate generally favors large reserves. They support larger, more viable populations of area-sensitive species and have fewer negative edge effects.' }
                },
                {
                    id: 'restoration-ecology',
                    title: 'Restoration Ecology',
                    description: 'Healing damaged ecosystems.',
                    content: {
                        explanation: 'Restoration ecology aims to return damaged ecosystems to historical conditions or functional states. This involves removing disturbances, reintroducing native species, controlling invasives, and restoring natural processes like fire or flooding. Success requires understanding reference conditions, setting realistic goals, and long-term commitment.',
                        visual: '🏚️ Degraded System → 🔧 Remove Stressors → 🌱 Reintroduce Species → ⚙️ Restore Processes → 🌳 Recovered Ecosystem',
                        example: 'Kissimmee River restoration in Florida is reversing channelization from the 1960s. By removing levees and restoring natural meandering over 100 km, wetlands have returned. Water quality improved, wetland birds increased 10-fold, and fish populations recovered. This $1.5 billion project shows restoration can work at landscape scales.',
                        limitations: 'Restoration limitations: (1) Historical baselines may be impossible to achieve due to climate change, (2) Invasive species often cannot be completely removed, (3) Restoration is expensive and slow, (4) Novel ecosystems may be more realistic than historical ones.'
                    },
                    challenge: { question: 'A drained wetland is being restored. Scientists debate aiming for the exact historical plant community vs. focusing on wetland functions (e.g., water filtration). Which is often better?', options: ['Historical accuracy - only original species are authentic', 'Functional restoration - ecosystem services matter more than specific species', 'Do nothing - nature will restore itself', 'Convert to a different ecosystem type'], correct: 1, explanation: 'Functional restoration is often more practical. Climate change and irreversible changes may prevent exact historical recreation. Focusing on restoring functions can be more successful and resilient.' }
                },
                {
                    id: 'ex-situ-conservation',
                    title: 'Ex-Situ Conservation',
                    description: 'Saving species outside their habitat.',
                    content: {
                        explanation: 'Ex-situ conservation maintains species outside natural habitats through zoos, botanical gardens, seed banks, and frozen genetic material. This provides insurance against extinction, maintains genetic diversity, and enables breeding for reintroduction. However, it\'s expensive, limited in scale, and cannot preserve ecological relationships.',
                        visual: '🏞️ Wild Population → 🏛️ Captive Breeding → 🧬 Genetic Banking → 🔬 Breeding Programs → 🦅 Reintroduction',
                        example: 'California condors dropped to just 27 birds in 1987. All were captured for captive breeding. Through careful genetic management and hand-rearing, the population has grown to over 500 birds with 300+ in the wild. This ex-situ intervention prevented certain extinction, though condors still face threats like lead poisoning.',
                        limitations: 'Ex-situ limitations: (1) Captive populations lose wild behaviors and may fail after release, (2) Genetic adaptation to captivity reduces wild fitness, (3) Can only save a tiny fraction of threatened species, (4) Does nothing to address threats in nature.'
                    },
                    challenge: { question: 'The Svalbard Global Seed Vault stores crop seeds in the Arctic. Critics say this diverts resources from protecting farms. What is the strongest counter-argument?', options: ['The vault is cheap to maintain', 'Seeds are more important than living populations', 'Ex-situ backup is essential insurance against catastrophic loss in nature', 'Technology will eliminate the need for crop diversity'], correct: 2, explanation: 'Ex-situ conservation (like seed banks) complements in-situ (on-site) protection. It acts as a vital insurance policy against disasters, wars, or diseases that could wipe out diversity in the wild.' }
                },
                {
                    id: 'community-conservation',
                    title: 'Community-Based Conservation',
                    description: 'Involving local people in conservation.',
                    content: {
                        explanation: 'Community-based conservation recognizes that local people must benefit from conservation for it to succeed. This includes ecotourism, sustainable harvest, payment for ecosystem services, and indigenous management. When communities have ownership and receive tangible benefits, they become conservation partners rather than opponents.',
                        visual: '👥 Local Community → 🤝 Conservation Partnership → 💰 Economic Benefits → 🌿 Habitat Protection → ♻️ Sustainable System',
                        example: 'Namibian communal conservancies give communities rights to wildlife and tourism revenue. Communities now protect rather than poach wildlife. Results: 70% increase in wildlife numbers, poaching nearly eliminated, $10 million annual income to rural communities. Lions, elephants, and rhinos have all recovered on community lands.',
                        limitations: 'Community conservation challenges: (1) Benefits may not offset opportunity costs of development, (2) Elite capture where leaders monopolize benefits, (3) Human-wildlife conflict remains difficult, (4) External markets and climate change undermine local management.'
                    },
                    challenge: { question: 'A village borders a forest with endangered primates that villagers hunt. What community-based solution would work best?', options: ['Ban hunting and enforce with armed guards', 'Develop alternative protein sources and employ villagers as primate research assistants', 'Relocate the village', 'Build a fence'], correct: 1, explanation: 'This solution addresses the root need (protein) while creating economic incentives for conservation (jobs). This transforms potential poachers into protectors.' }
                },
                {
                    id: 'umbrella-species',
                    title: 'Umbrella Species',
                    description: 'Conservation by protecting large-range species.',
                     content: {
                        explanation: "An umbrella species is a species selected for making conservation-related decisions, typically because protecting these species indirectly protects the many other species that make up the ecological community of its habitat. They usually have large home ranges or specialized habitat needs, so protecting them automatically protects a wide swath of land or a specific habitat type.",
                        visual: "Protect 🐻 (Large Range) → Automatically Protects 🦌🐇🐦🌲(everything in its habitat)",
                        example: "The grizzly bear in North America is an excellent umbrella species. A single grizzly bear requires a vast, healthy, and connected landscape to survive. By setting aside enough land to protect a viable grizzly bear population, we automatically protect hundreds of other species—from elk and wolves to birds and plants—that live within that same ecosystem."
                    },
                    challenge: { question: 'Protecting a species like the grizzly bear, which requires a very large and healthy habitat, also protects many other species within that habitat. The grizzly bear is an example of a(n):', options: ['Keystone species', 'Indicator species', 'Umbrella species', 'Flagship species'], correct: 2, explanation: 'An umbrella species is a species whose conservation is expected to confer protection to a large number of naturally co-occurring species.' }
                },
                {
                    id: 'flagship-species',
                    title: 'Flagship Species',
                    description: 'Charismatic species as conservation ambassadors.',
                     content: {
                        explanation: "A flagship species is a species chosen to act as an ambassador or symbol for a conservation cause. These species are typically charismatic, large, and appealing to the public, like pandas, tigers, or whales. The goal is to leverage their appeal to raise public awareness and funding for broader conservation efforts that may benefit them and many other less-charismatic species.",
                        visual: "🐼 Cute Panda → ❤️ Public Support → 💰 Donations → 🌱 Protects Panda's Entire Bamboo Forest Habitat",
                        example: "The Giant Panda is perhaps the most famous flagship species. It is the symbol of the World Wildlife Fund (WWF). By raising money to 'save the panda,' conservation organizations are able to fund the protection of the vast mountain bamboo forest ecosystems in China where the pandas live, thereby protecting thousands of other species."
                    },
                    challenge: { question: 'Conservation organizations often use charismatic species like the Giant Panda or Tiger to raise public awareness and funding. These are known as:', options: ['Keystone species', 'Indicator species', 'Umbrella species', 'Flagship species'], correct: 3, explanation: 'A flagship species is a species chosen to act as an ambassador or symbol for a defined habitat, issue, or environmental cause. They are often charismatic and appealing to the public.' }
                },
                {
                    id: 'wildlife-corridors',
                    title: 'Wildlife Corridors',
                    description: 'Connecting fragmented habitats.',
                     content: {
                        explanation: "Wildlife corridors are strips of habitat that connect larger, isolated patches of habitat. In a world fragmented by roads, cities, and farms, corridors are essential for allowing animals to move between patches. This movement is critical for finding food, mates, and new territories, as well as maintaining genetic diversity by preventing populations from becoming inbred.",
                        visual: "🌳 Habitat Patch 1 ← [🌲🌲🌲 Corridor 🌲🌲🌲] → 🌳 Habitat Patch 2",
                        example: "Wildlife overpasses and underpasses built over and under major highways are a form of corridor. In Banff National Park, Canada, dozens of these structures allow grizzly bears, wolves, elk, and other animals to safely cross the Trans-Canada Highway. Camera traps show thousands of successful crossings per year, proving their effectiveness in reconnecting a fragmented landscape."
                    },
                    challenge: { question: 'What is the primary purpose of building wildlife corridors or "ecoducts" over highways?', options: ['To provide a scenic route for animals', 'To connect fragmented habitats and maintain gene flow', 'To make it easier for tourists to see wildlife', 'To prevent animals from entering farmlands'], correct: 1, explanation: 'Wildlife corridors are connections across landscapes that link up areas of habitat. They are critical for allowing migration, colonization, and interbreeding between otherwise isolated populations.' }
                },
                {
                    id: 'conservation-genetics',
                    title: 'Conservation Genetics',
                    description: 'Using genetics to manage populations.',
                     content: {
                        explanation: "Conservation genetics is a field that applies genetic methods to the conservation and restoration of biodiversity. It uses tools like DNA sequencing to assess the genetic health of populations (e.g., inbreeding levels), resolve taxonomic uncertainties, manage captive breeding programs to maximize genetic diversity, and trace the source of illegal wildlife products.",
                        visual: "🧬 DNA Analysis → 📊 Assess Genetic Health → 👨‍👩‍👧‍👦 Plan Breeding Pairs → 💚 Healthier, more resilient population",
                        example: "For the critically endangered Florida panther, genetic analysis revealed severe inbreeding and associated health problems. Based on these findings, conservation managers made the controversial but successful decision to introduce eight female pumas from Texas in 1995. This infusion of new genes (gene flow) revitalized the population, increasing its numbers and long-term viability."
                    },
                    challenge: { question: 'Why is it important to maintain genetic diversity in endangered species recovery programs?', options: ['To make all individuals look identical', 'To prevent the species from evolving further', 'To provide the raw material for adaptation to future environmental changes', 'It is not important; population size is all that matters'], correct: 2, explanation: 'Genetic diversity is crucial for a population\'s long-term survival. It increases the likelihood that some individuals will have the traits necessary to survive diseases, climate change, or other threats.' }
                },
                {
                    id: 'rewilding',
                    title: 'Rewilding',
                    description: 'Restoring ecosystems to self-sufficiency.',
                     content: {
                        explanation: "Rewilding is a progressive approach to conservation aimed at restoring natural processes and wilderness areas to a state where they can manage themselves without human intervention. It often focuses on reintroducing apex predators or large herbivores (keystone species) to restore top-down ecological processes and trophic cascades, letting nature take the lead.",
                        visual: "🏞️ Damaged/Managed Land → Reintroduce 🐺+🦬 → Restore Trophic Cascades → 🌳 Self-Sustaining Wilderness",
                        example: "The reintroduction of wolves to Yellowstone National Park is a form of rewilding. Instead of actively managing elk populations, conservationists restored the natural predator, allowing the ecosystem to find its own balance. This led to a cascade of positive changes, including the recovery of vegetation, beavers, and songbirds, demonstrating the power of restoring natural processes."
                    },
                    challenge: { question: 'The large-scale conservation effort to restore and protect natural processes and core wilderness areas, often by reintroducing large predators or keystone species, is known as:', options: ['Sustainable development', 'Ex-situ conservation', 'Rewilding', 'Agroforestry'], correct: 2, explanation: 'Rewilding aims to restore ecosystems to a point where nature can take care of itself, often by reintroducing apex predators or keystone species to restore top-down trophic cascades.' }
                },
                {
                    id: 'debt-for-nature-swap',
                    title: 'Debt-for-Nature Swap',
                    description: 'A financial tool for conservation.',
                     content: {
                        explanation: "A debt-for-nature swap is a financial tool where a portion of a developing nation's foreign debt is forgiven or bought by a third party (like a conservation NGO) in exchange for the country's commitment to invest in domestic environmental conservation. It turns a financial burden into a sustainable funding stream for protecting biodiversity.",
                        visual: "Country owes 💰 to Bank → NGO buys debt at discount → Country pays NGO smaller amount → Money goes to 🌳 Conservation",
                        example: "In 2021, a major debt-for-nature swap was arranged for Belize to protect its barrier reef, the second-largest in the world. The deal restructured $553 million of national debt, reducing the country's debt burden and generating an estimated $4 million per year for marine conservation, and a commitment to protect 30% of its ocean territory."
                    },
                    challenge: { question: 'A financial transaction in which a portion of a developing nation\'s foreign debt is forgiven in exchange for local investments in environmental conservation measures is called a:', options: ['Carbon tax', 'Green bond', 'Ecotourism fee', 'Debt-for-nature swap'], correct: 3, explanation: 'Debt-for-nature swaps are innovative financial mechanisms that provide a win-win for conservation and economic development, allowing countries to reduce debt while protecting their natural resources.' }
                }
            ],
            'biodiversity-gradients': [
                {
                    id: 'latitudinal-gradient',
                    title: 'Latitudinal Gradient',
                    description: 'Why the tropics have more species.',
                    content: {
                        explanation: 'The latitudinal diversity gradient is Earth\'s most striking biodiversity pattern - species richness decreases from equator to poles. A single hectare of Amazon rainforest can have more tree species (300+) than all of North America. This pattern holds for most groups: birds, mammals, plants, insects, marine life. Understanding why has challenged ecologists for centuries.',
                        visual: '🌴 Equator (High Diversity) → 🌳 Temperate (Medium) → 🌲 Boreal (Low) → ❄️ Poles (Minimal)',
                        example: 'Ant diversity shows extreme latitudinal gradient: 3000+ species in Brazil, 600 in USA, 60 in Canada, 3 in Arctic. Similarly, tree diversity: 40,000 tropical species vs 1,000 temperate species. Even marine systems show this - coral reefs (tropics) have 10x more fish species than kelp forests (temperate).',
                        limitations: 'Gradient exceptions: (1) Some groups peak outside tropics (seabirds, soil microbes), (2) Peninsular effect confounds at continent tips, (3) Human activity has altered natural patterns, (4) Deep ocean shows weak or no gradient.'
                    },
                    challenge: { question: 'If climate change makes polar regions warmer, will they develop tropical levels of biodiversity?', options: ['Yes - temperature is the only factor', 'No - evolution takes millions of years; warming alone cannot create diversity', 'Yes - species will quickly migrate', 'No - polar regions have longer days'], correct: 1, explanation: 'Tropical diversity accumulated over millions of years of evolution in a stable climate. Warming the poles won\'t instantly generate this diversity; speciation takes geological time and depends on many factors besides temperature.' }
                },
                {
                    id: 'energy-hypothesis',
                    title: 'Energy Hypothesis',
                    description: 'How solar power drives diversity.',
                    content: {
                        explanation: 'The energy hypothesis proposes that diversity correlates with available energy - more energy supports more individuals, allowing more species to maintain viable populations. Tropics receive more consistent solar energy year-round, driving higher productivity. More energy means more resources, more individuals, larger populations, and lower extinction rates.',
                        visual: '☀️ Solar Energy → 🌱 Primary Productivity → 🐛 More Individuals → 📈 Larger Populations → 🦋 More Species',
                        example: 'Tropical rainforests receive 2-3x more solar energy than temperate forests and maintain constant temperatures. This supports year-round growth and reproduction. A hectare of rainforest produces 20-30 tons of biomass annually vs 10-15 tons in temperate forest. This energy surplus cascades up food chains, supporting incredible diversity.',
                        limitations: 'Energy hypothesis problems: (1) Some highly productive systems have low diversity (salt marshes, agricultural fields), (2) Energy-diversity relationships are often hump-shaped, not linear, (3) Deserts have high solar input but low diversity, (4) Historical factors may matter more than current energy.'
                    },
                    challenge: { question: 'Hydrothermal vents in the deep ocean have enormous chemical energy but low species diversity. How does this challenge the energy hypothesis?', options: ['It does not challenge it - chemical energy does not count', 'It shows energy type and quality matters, not just the amount', 'Vents actually have high diversity', 'The deep ocean is too cold regardless of energy'], correct: 1, explanation: 'This reveals that the type of energy is crucial. Solar energy supports complex photosynthetic food webs, while the specialized chemosynthetic communities at vents are less diverse. Quality and form of energy matter.' }
                },
                {
                    id: 'time-hypothesis',
                    title: 'Time Hypothesis',
                    description: 'Why stable, old ecosystems are more diverse.',
                    content: {
                        explanation: 'The evolutionary time hypothesis suggests tropics have higher diversity because they\'ve existed longer without disruption. Tropical regions avoided ice ages that repeatedly wiped out temperate and polar life. More time allows more speciation, fine-tuned specialization, and complex coevolution. Think of it as compound interest for biodiversity.',
                        visual: '⏰ Geological Time → 🧬 Speciation Events → 🌿 Niche Specialization → 🔄 Coevolution → 🌺 High Diversity',
                        example: 'Tropical rainforests have persisted for 60+ million years while northern forests were repeatedly bulldozed by glaciers (last one ended just 12,000 years ago). Amazon tree genus Inga has evolved 300+ species through long uninterrupted evolution. Meanwhile, post-glacial northern forests have just dozens of tree species that recolonized from southern refugia.',
                        limitations: 'Time hypothesis issues: (1) Some ancient habitats have low diversity (deep ocean), (2) Rapid adaptive radiation can generate diversity quickly, (3) Too much stability might reduce speciation, (4) Distinguishes poorly between time for speciation vs time without extinction.'
                    },
                    challenge: { question: 'Islands can be very old and stable, yet often have lower diversity than mainland areas. How does this complicate the evolutionary time hypothesis?', options: ['Islands are too small to count', 'It shows isolation and area constraints can override time effects', 'Island species are younger than they appear', 'Ocean barriers prevent evolution'], correct: 1, explanation: 'Islands demonstrate that time alone doesn\'t guarantee high diversity. Limited area (leading to smaller populations and higher extinction) and isolation (limiting colonization) constrain diversity regardless of evolutionary time.' }
                },
                {
                    id: 'climate-stability',
                    title: 'Stability Hypothesis',
                    description: 'How predictable climates promote specialization.',
                    content: {
                        explanation: 'Stable, predictable climates allow species to specialize on narrow niches without risk of conditions changing beyond tolerance. Tropics have minimal seasonal variation - temperature varies more in a single day in temperate regions than across the year in tropics. This stability permits extreme specialization and niche partitioning impossible in variable climates.',
                        visual: '🌡️ Stable Climate → 🎯 Narrow Niches → 🔬 Specialization → 🕸️ Complex Interactions → 🦜 High Diversity',
                        example: 'Tropical hummingbird-flower coevolution shows extreme specialization enabled by stability. Sword-billed hummingbirds have 10cm bills matched perfectly to specific passion flowers. Such specialization would be fatal in seasonal climates where flower availability varies. One hard winter would doom overspecialized species.',
                        limitations: 'Stability hypothesis problems: (1) Some stable environments have low diversity (cave systems), (2) Intermediate disturbance may promote diversity, (3) Too much stability could reduce speciation rates, (4) Microhabitat variation exists even in "stable" tropics.'
                    },
                    challenge: { question: 'Tropical mountains have high diversity with distinct communities at each elevation. How does the stability hypothesis explain this?', options: ['Mountains are unstable due to landslides', 'Elevation gradients pack many stable climate zones into a small area', 'Mountain species are not actually diverse', 'High UV radiation accelerates evolution'], correct: 1, explanation: 'Tropical mountains are "diversity engines" because they compress many different but stable climate zones into a small geographic area. Each elevation has predictable conditions allowing specialization, creating high overall diversity.' }
                },
                {
                    id: 'speciation-rates',
                    title: 'Speciation Rate Hypothesis',
                    description: 'The idea that evolution is faster in the tropics.',
                    content: {
                        explanation: 'Tropics may have inherently faster speciation rates due to shorter generation times, higher mutation rates (UV radiation, warm temperatures), stronger biotic interactions driving coevolution, and year-round reproduction. Faster molecular evolution in warm climates could accelerate the "speciation clock," generating diversity more rapidly than in cold regions.',
                        visual: '🌡️ Warm Temperature → ⚡ Faster Metabolism → 🧬 Higher Mutation Rate → 🔄 Shorter Generations → 🆕 More Species',
                        example: 'Plant generation times: tropical trees can reproduce in 5-10 years vs 20-50 years for temperate trees. Tropical insects may have 10+ generations annually vs 1-2 in temperate zones. DNA evolution rates are 2x faster in tropical than polar marine snails. These differences compound over time into vastly different diversification rates.',
                        limitations: 'Speciation rate challenges: (1) Some tropical groups have slow speciation (crocodilians), (2) Rapid Arctic evolution occurs during climate change, (3) Extinction rates may also be higher in tropics, (4) Hard to separate speciation rates from time effects.'
                    },
                    challenge: { question: 'If tropical speciation is faster, why do "living fossils" like coelacanths and cycads persist mainly in tropical regions?', options: ['These organisms evolve rapidly but look unchanged', 'Stable tropical conditions can preserve ancient lineages while also generating new ones', 'Living fossils are not really ancient', 'Tropical speciation rates are actually slow'], correct: 1, explanation: 'This paradox shows the tropics are both an evolutionary "cradle" (generating new species) and a "museum" (preserving ancient ones). Stable conditions allow both processes to occur simultaneously.' }
                },
                {
                    id: 'ecological-limits',
                    title: 'Ecological Limits Hypothesis',
                    description: 'How species pack into crowded communities.',
                    content: {
                        explanation: 'This hypothesis suggests tropical communities can pack more species through finer niche partitioning. Stable conditions allow species to specialize on very narrow resource ranges. Tropics also have more vertical structure (forest layers) and temporal partitioning (year-round activity) creating more available niches in the same space.',
                        visual: '🌳 3D Structure → 📦 Niche Space → ✂️ Fine Partitioning → 🔬 Microhabitats → 🐜 Dense Packing',
                        example: 'A single tropical tree can host 100+ ant species through elaborate partitioning: canopy ants, trunk ants, leaf-litter ants, seed-harvesting ants, fungus-growing ants, predatory ants - each using different parts at different times. Temperate trees might host 10-20 ant species using broader, overlapping niches.',
                        limitations: 'Ecological limits problems: (1) No clear limit to how finely niches can be divided, (2) Neutral theory suggests many species share identical niches, (3) High diversity might cause niche partitioning, not result from it, (4) Difficult to measure all relevant niche dimensions.'
                    },
                    challenge: { question: 'Two rainforest bird species eat the same fruit but coexist. One feeds at dawn, the other at dusk. What would happen if day length became highly variable?', options: ['Nothing - timing does not matter', 'One species would likely outcompete the other', 'Both would evolve to eat different fruits', 'They would partition space instead of time'], correct: 1, explanation: 'Variable day length would disrupt their temporal niche partitioning, forcing them into direct competition. Without predictable separate feeding times, the competitively superior species would likely win out.' }
                },
                {
                    id: 'biotic-interactions',
                    title: 'Biotic Interactions Hypothesis',
                    description: 'How interactions drive evolutionary arms races.',
                    content: {
                        explanation: 'Intense biotic interactions in tropics - predation, parasitism, competition - may drive faster evolution and specialization. The "Red Queen" hypothesis suggests species must constantly evolve just to maintain fitness against coevolving enemies. Tropics have more predators, parasites, and pathogens creating stronger selection for defense and counter-defense evolution.',
                        visual: '🦎 Predator Pressure → 🛡️ Defense Evolution → 🗡️ Counter-adaptation → ⚔️ Arms Race → 🌀 Diversification',
                        example: 'Tropical plant diversity may be maintained by specialized pests. Janzen-Connell hypothesis: species-specific seed predators and pathogens prevent any one tree species from dominating. Seeds falling near parents are killed by specialized enemies, maintaining diversity. Temperate forests have fewer specialized pests, allowing dominance.',
                        limitations: 'Biotic interactions challenges: (1) Strong interactions could also reduce diversity through competitive exclusion, (2) Mutualistic interactions complicate the arms race model, (3) Difficult to prove interactions cause rather than result from diversity, (4) Some high-diversity systems have weak interactions.'
                    },
                    challenge: { question: 'Tropical coral reefs have intense predation yet extraordinary diversity. How does predation promote diversity here?', options: ['Predators are rare on reefs', 'Predation prevents competitive dominance by eating superior competitors', 'Prey species are immune to predation', 'Coral reefs have no competition'], correct: 1, explanation: 'This is the "keystone predator" effect. By preying on the most abundant or competitively dominant species, predators prevent them from monopolizing resources, freeing up space for less competitive species to thrive.' }
                },
                {
                    id: 'mid-domain-effect',
                    title: 'Mid-Domain Effect',
                    description: 'Geometric constraints on species ranges.',
                    content: {
                        explanation: 'The mid-domain effect proposes that diversity peaks at mid-latitudes simply due to geometric constraints - random species ranges overlap most at the center of bounded domains. Like randomly throwing darts at a board, more will overlap in the middle than edges. This null model suggests patterns could arise without environmental gradients.',
                        visual: '|← Species Range 1 →| |← Range 2 →| |← Range 3 →| = Maximum Overlap at Center',
                        example: 'Imagine 100 species with random range sizes between poles. Even if all latitudes were identical environments, more ranges would overlap at the equator than poles just by geometry. Computer simulations show this effect alone can generate realistic-looking diversity gradients without any environmental differences.',
                        limitations: 'Mid-domain limitations: (1) Real ranges are not random but shaped by environment and history, (2) Cannot explain why gradients exist in unbounded systems (oceanic depth), (3) Predicts symmetrical patterns rarely seen in nature, (4) Explains pattern but not underlying range size variation.'
                    },
                    challenge: { question: 'Mountain diversity often peaks at mid-elevations, not the base. How might the mid-domain effect (a null model) explain this?', options: ['Mid-elevations have the best climate', 'Species ranges bounded by base and peak will geometrically overlap most in the middle', 'Predators are absent at mid-elevations', 'Humans have disturbed lowland areas'], correct: 1, explanation: 'The mid-domain effect is a geometric argument. If species have ranges of various sizes within a bounded domain (like a mountain), there is a higher probability of range overlap in the center (mid-elevation) than at the edges.' }
                },
                {
                    id: 'area-hypothesis',
                    title: 'Geographic Area Hypothesis',
                    description: 'How larger areas support more species.',
                    content: {
                        explanation: 'Tropics simply cover more area than temperate or polar zones due to Earth\'s spherical shape. Larger areas support larger populations (lower extinction), more habitat heterogeneity (more niches), and higher speciation probability (more isolated populations). This species-area relationship is one of ecology\'s few laws.',
                        visual: '🌍 Tropical Belt Area → 📏 40% of Earth → 🏠 More Habitats → 👥 Larger Populations → 🌴 More Species',
                        example: 'Tropical land area between 23°N and 23°S comprises 40% of Earth\'s land. Temperate zones (23-66°) are 36%, polar regions just 24%. Additionally, tropical conditions extend across continents while polar conditions are fragmented. This vast continuous tropical area can support more total species through area effects alone.',
                        limitations: 'Area hypothesis problems: (1) Deserts are extensive but species-poor, (2) Area effects do not explain marine patterns where ocean zones have similar areas, (3) Cannot explain why similar-sized regions at different latitudes differ in diversity, (4) Historical continental positions confound current area effects.'
                    },
                    challenge: { question: 'Australia and South America have similar tropical land areas, yet the Amazon has far more species. What does this suggest about the area hypothesis?', options: ['Area does not affect diversity', 'Area is important, but not sufficient; other factors like history and climate matter', 'South America is actually much larger', 'Australian species are hidden'], correct: 1, explanation: 'This shows that while area is a key factor, it is not the only one. The Amazon\'s history of stability, climate, and geographic complexity (e.g., the Andes) have also driven its exceptionally high diversity.' }
                },
                {
                    id: 'productivity-hypothesis',
                    title: 'Productivity Hypothesis',
                    description: 'How resource abundance affects diversity.',
                    content: {
                        explanation: 'High tropical productivity means more resources to divide among species. Like a bigger pie allows more slices, higher productivity supports more individuals and species. Year-round plant growth supports continuous insect populations, supporting more insectivores, and so on up the food chain. However, the productivity-diversity relationship is complex and often hump-shaped.',
                        visual: '☀️ Energy Input → 🌿 Plant Growth → 🐛 Herbivore Biomass → 🦜 Consumer Diversity → 🌳 System Capacity',
                        example: 'Tropical rainforests produce 2,200 g/m²/year of biomass vs 1,200 g/m²/year in temperate forests. This extra productivity supports entire guilds absent from temperate systems: specialized fruit-eating birds and bats, year-round nectar feeders, diverse decomposers processing constant leaf fall. Each productivity increment enables new specialist niches.',
                        limitations: 'Productivity problems: (1) Most productive systems (marshes, estuaries) are not most diverse, (2) Fertilization often reduces plant diversity, (3) Productivity-diversity relationships are scale-dependent, (4) Hard to separate productivity effects from correlated factors like stability.'
                    },
                    challenge: { question: 'Fertilizing grasslands often reduces plant species diversity despite increasing productivity. How does this challenge the simple idea that "more productivity = more diversity"?', options: ['Grasslands are exceptions', 'It shows high productivity can lead to competitive exclusion, reducing diversity', 'Fertilizer is toxic', 'The hypothesis only applies to tropics'], correct: 1, explanation: 'This is the "paradox of enrichment." High resource availability can allow a few fast-growing species to become dominant and outcompete all other species, leading to a decrease in overall diversity.' }
                },
                 {
                    id: 'janzen-connell',
                    title: 'Janzen-Connell Hypothesis',
                    description: 'How specialized pests maintain tree diversity.',
                    content: {
                        explanation: "The Janzen-Connell Hypothesis proposes a mechanism for maintaining high tree diversity in tropical forests. It suggests that specialized natural enemies, such as herbivores and pathogens (pests), are concentrated near parent trees. As a result, seeds and seedlings have a much lower survival rate when they are close to their parent or other members of the same species. This creates a 'repulsion' effect, opening up space for other species to establish and preventing any single species from becoming dominant.",
                        visual: "🌳 Parent Tree → 🌰 Seeds fall close by → 🐛 Pests attack seeds/seedlings → 🌱 Only distant seeds survive → Space for other species",
                        example: "In a tropical forest, if you map the location of a parent tree and all its seedlings, you'll often find a 'doughnut' pattern of survival. There's a 'dead zone' around the parent tree where pests and diseases are so concentrated that no seedlings survive. The successful seedlings are those that were dispersed further away, leaving space for other tree species to grow near the parent."
                    },
                    challenge: { question: 'What does the Janzen-Connell hypothesis primarily use to explain high tree diversity in the tropics?', options: ['High rainfall and sunlight', 'Host-specific pests and pathogens that kill seedlings near the parent tree', 'A long history without glaciation', 'High rates of mutation'], correct: 1, explanation: 'This hypothesis suggests that specialized natural enemies (insects, fungi) prevent any single species from dominating by killing its offspring near the parent tree, thus opening up space for other species to establish.' }
                }
            ]
        };
        // --- APPLICATION STATE ---
        let state = {
            gameMode: 'menu', // 'menu', 'single', 'multiplayer', 'study'
            // Shared state
            currentModuleId: null,
            currentLevelIndex: null,
            // Single player state
            userProgress: {},
            selectedAnswer: null,
            showResult: false,
            // Multiplayer state
            multiplayer: {
                status: 'setup', // 'setup', 'playing', 'results'
                players: [
                    { name: 'Player 1', score: 0 },
                    { name: 'Player 2', score: 0 }
                ],
                currentTurnIndex: 0,
                selectedModuleId: 'levels-of-biodiversity',
                quizQuestions: [],
                currentQuestionIndex: 0,
                attemptedPlayersForCurrentQuestion: [],
                showAnswer: false, // Can be: false, 'feedback', true
                lastAnswerCorrect: false,
                selectedAnswerIndex: null,
            }
        };
        const appContainer = document.getElementById('app-container');
        const PROGRESS_KEY = 'biodiversityQuestProgress';
        // --- STATE MANAGEMENT FUNCTIONS ---
        function loadProgress() {
            const savedProgress = localStorage.getItem(PROGRESS_KEY);
            state.userProgress = savedProgress ? JSON.parse(savedProgress) : {};
        }
        function saveProgress() {
            localStorage.setItem(PROGRESS_KEY, JSON.stringify(state.userProgress));
        }
        function resetProgress() {
            if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
                state.userProgress = {};
                saveProgress();
                render();
            }
        }
        // --- RENDERING FUNCTIONS ---
        function render() {
            appContainer.innerHTML = ''; // Clear previous content
            let viewHtml = '';
            if (state.gameMode === 'menu') {
                viewHtml = renderMainMenuScreen();
            } else if (state.gameMode === 'single' || state.gameMode === 'study') {
                 if (state.currentModuleId === null) {
                    viewHtml = renderModuleSelectionScreen();
                } else if (state.currentLevelIndex === null) {
                    viewHtml = renderLevelSelectionScreen();
                } else {
                    viewHtml = renderLevelDetailScreen();
                }
            } else if (state.gameMode === 'multiplayer') {
                if (state.multiplayer.status === 'setup') {
                    viewHtml = renderMultiplayerSetupScreen();
                } else if (state.multiplayer.status === 'playing') {
                    viewHtml = renderMultiplayerGameScreen();
                } else if (state.multiplayer.status === 'results') {
                    viewHtml = renderMultiplayerResultsScreen();
                }
            }
            appContainer.innerHTML = viewHtml;
            window.scrollTo(0, 0); // Scroll to top on view change
        }
        function renderMainMenuScreen() {
             return `
                <div class="max-w-2xl mx-auto flex flex-col items-center justify-center min-h-[calc(100vh-150px)] fade-in">
                    <header class="text-center mb-12">
                        <h1 class="text-6xl font-extrabold text-slate-900 mb-3">🌱</h1>
                        <h1 class="text-5xl font-extrabold text-slate-900 mb-2">Biodiversity Quest</h1>
                        <p class="text-slate-600 text-lg">An interactive journey through the science of biodiversity.</p>
                    </header>
                    <div class="w-full max-w-sm space-y-4">
                        <button class="start-single-player-btn w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-xl text-lg hover:bg-blue-700 transition-transform hover:scale-105 shadow-lg">
                            Single Player (Learn & Quiz)
                        </button>
                         <button class="start-study-btn w-full bg-green-600 text-white font-bold py-4 px-6 rounded-xl text-lg hover:bg-green-700 transition-transform hover:scale-105 shadow-lg">
                            Study Guide (Browse Topics)
                        </button>
                        <button class="start-multiplayer-btn w-full bg-purple-600 text-white font-bold py-4 px-6 rounded-xl text-lg hover:bg-purple-700 transition-transform hover:scale-105 shadow-lg">
                            Multiplayer Quiz
                        </button>
                    </div>
                </div>
            `;
        }
        function renderModuleSelectionScreen() {
            const isStudyMode = state.gameMode === 'study';
            const totalModules = GAME_MODULES.length;
            const completedModules = GAME_MODULES.filter(m => {
                const levelsInModule = MODULE_CONTENT[m.id];
                if (!levelsInModule) return false;
                const completedInModule = levelsInModule.filter(l => state.userProgress[`${m.id}-${l.id}`]).length;
                return completedInModule === levelsInModule.length;
            }).length;
            let moduleCardsHtml = GAME_MODULES.map(module => {
                const levels = MODULE_CONTENT[module.id] || [];
                const completedLevels = levels.filter(level => state.userProgress[`${module.id}-${level.id}`]).length;
                const totalLevels = levels.length;
                const isComplete = completedLevels === totalLevels;
                const starsHtml = !isStudyMode ? [...Array(totalLevels)].map((_, i) => `
                    <div class=" ${i < completedLevels ? 'text-yellow-400' : 'text-slate-300'}">
                        ${ICONS.Star.replace('width="16"', 'width="18"').replace('height="16"', 'height="18"').replace('<polygon', '<polygon fill="currentColor"')}
                    </div>
                `).join('') : '';
                return `
                    <div class="module-card bg-white rounded-xl shadow-md p-6 cursor-pointer transform hover:-translate-y-1 transition-all duration-300 border border-slate-200 hover:shadow-xl hover:border-blue-400" data-module-id="${module.id}">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                               <div class="w-12 h-12 rounded-lg flex items-center justify-center mr-4" style="background-color: ${module.color}20;">
                                    <div style="color: ${module.color};">${ICONS[module.icon]}</div>
                               </div>
                               <div>
                                    <h3 class="font-bold text-lg text-slate-800">${module.title}</h3>
                                    ${!isStudyMode ? `<div class="flex items-center mt-1 space-x-1 flex-wrap">${starsHtml}</div>` : ''}
                               </div>
                            </div>
                            ${isComplete && !isStudyMode ? `<div class="text-green-500">${ICONS.CheckCircle}</div>` : ''}
                        </div>
                        <p class="text-slate-600 text-sm mb-4">${module.description}</p>
                        ${!isStudyMode ? `
                        <div class="bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div class="h-full rounded-full" style="width: ${(completedLevels / totalLevels) * 100}%; background-color: ${module.color};"></div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            return `
                <div class="max-w-6xl mx-auto fade-in">
                    <header class="text-center mb-10">
                         <h1 class="text-5xl font-extrabold text-slate-900 mb-2">${isStudyMode ? '📚 Study Guide' : '🌱 Biodiversity Quest'}</h1>
                        <p class="text-slate-600 text-lg">${isStudyMode ? 'Browse all topics and educational content.' : 'An interactive journey through the science of biodiversity.'}</p>
                    </header>
                    ${!isStudyMode ? `
                    <div class="bg-white rounded-xl shadow p-6 mb-8 border border-slate-200">
                        <h2 class="font-bold text-xl mb-3">Your Progress</h2>
                        <div class="flex items-center justify-between">
                            <p class="text-slate-600">You've completed <strong>${completedModules}</strong> of <strong>${totalModules}</strong> modules.</p>
                            <button class="reset-progress-btn text-sm font-semibold text-red-600 hover:text-red-800 transition">
                                Reset Progress
                            </button>
                        </div>
                        <div class="bg-slate-200 h-3 rounded-full mt-3 overflow-hidden">
                             <div class="bg-blue-500 h-full rounded-full" style="width: ${(completedModules / totalModules) * 100}%;"></div>
                        </div>
                    </div>` : ''}
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${moduleCardsHtml}
                    </div>
                     <button class="main-menu-btn mt-8 flex items-center mx-auto text-sm font-semibold text-slate-600 hover:text-slate-900 transition p-2 rounded-lg hover:bg-slate-200">
                        ${ICONS.ChevronLeft} Back to Main Menu
                    </button>
                </div>
            `;
        }
        function renderLevelSelectionScreen() {
             const module = GAME_MODULES.find(m => m.id === state.currentModuleId);
             const levels = MODULE_CONTENT[state.currentModuleId] || [];
             const isStudyMode = state.gameMode === 'study';
             let levelsHtml = levels.map((level, index) => {
                const isCompleted = state.userProgress[`${state.currentModuleId}-${level.id}`];
                return `
                    <div class="level-card flex items-center p-4 rounded-lg bg-white hover:bg-slate-50 cursor-pointer shadow-sm hover:shadow-md border transition-all duration-200" data-level-index="${index}">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: ${isCompleted && !isStudyMode ? '#27ae60' : module.color+'30'}; color: ${isCompleted && !isStudyMode ? 'white' : module.color};">
                            ${isCompleted && !isStudyMode ? ICONS.CheckCircle : `<strong>${index + 1}</strong>`}
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-semibold text-slate-800">${level.title}</h4>
                            <p class="text-sm text-slate-500">${level.description}</p>
                        </div>
                        <div class="text-slate-400">${ICONS.ChevronRight}</div>
                    </div>
                `;
             }).join('');
             return `
                <div class="max-w-4xl mx-auto fade-in">
                    <nav class="mb-8 flex items-center">
                         <button class="back-to-modules-btn p-2 rounded-full hover:bg-slate-200 transition">
                            ${ICONS.ChevronLeft}
                        </button>
                        <div class="flex items-center ml-2">
                             <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3" style="background-color: ${module.color}20;">
                                <div style="color: ${module.color};">${ICONS[module.icon]}</div>
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold text-slate-900">${module.title}</h1>
                                <p class="text-slate-600">${module.description}</p>
                            </div>
                        </div>
                    </nav>
                    <div class="space-y-4">
                        ${levelsHtml}
                    </div>
                </div>
             `;
        }
        function renderLevelDetailScreen() {
            const module = GAME_MODULES.find(m => m.id === state.currentModuleId);
            const levels = MODULE_CONTENT[state.currentModuleId];
            const level = levels[state.currentLevelIndex];
            const { content, challenge } = level;
            const isStudyMode = state.gameMode === 'study';
            const hasContent = content && Object.keys(content).length > 0;
            const measuresHtml = hasContent && content.measures ? Object.entries(content.measures).map(([key, value]) => `
                <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                    <h5 class="font-semibold text-blue-700 mb-2">${key}</h5>
                    <p class="text-slate-700 mb-2">${value.description}</p>
                    ${value.formula ? `<div class="bg-white rounded p-2 mb-2 font-mono text-sm border"><strong>Formula:</strong> ${value.formula}</div>` : ''}
                    ${value.range ? `<p class="text-sm text-slate-600 mb-1"><strong>Range:</strong> ${value.range}</p>` : ''}
                    ${value.interpretation ? `<p class="text-sm text-slate-600 mb-1"><strong>Interpretation:</strong> ${value.interpretation}</p>` : ''}
                    ${value.whenToUse ? `<p class="text-sm text-slate-600 mb-1"><strong>When to use:</strong> ${value.whenToUse}</p>` : ''}
                    ${value.limitations ? `<div class="text-sm text-red-700 bg-red-50 p-3 rounded-lg"><strong>Limitations:</strong> ${value.limitations}</div>` : ''}
                </div>
            `).join('') : '';
            const optionsHtml = challenge.options.map((option, index) => {
                let buttonClass = 'border-slate-300 hover:border-blue-500 hover:bg-blue-50';
                if (state.showResult) {
                    if (index === challenge.correct) {
                        buttonClass = 'bg-green-100 border-green-500 text-green-800';
                    } else if (index === state.selectedAnswer) {
                        buttonClass = 'bg-red-100 border-red-500 text-red-800';
                    } else {
                        buttonClass = 'border-slate-300 opacity-60';
                    }
                } else if (index === state.selectedAnswer) {
                    buttonClass = 'bg-blue-100 border-blue-500';
                }
                return `
                    <button class="answer-option w-full text-left p-4 border-2 rounded-lg transition-all ${buttonClass}" data-answer-index="${index}" ${state.showResult ? 'disabled' : ''}>
                        ${option}
                    </button>
                `;
            }).join('');
            const isCorrect = state.selectedAnswer === challenge.correct;
            const nextLevelExists = state.currentLevelIndex < levels.length - 1;
            const resultHtml = state.showResult ? `
                <div class="mt-4 p-4 rounded-lg ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
                    <h4 class="font-bold text-lg ${isCorrect ? 'text-green-800' : 'text-red-800'}">${isCorrect ? 'Correct!' : 'Not Quite'}</h4>
                    <p class="text-slate-700 mt-2">${challenge.explanation}</p>
                    <div class="mt-4 flex gap-4">
                        ${isCorrect && nextLevelExists ? `<button class="next-level-btn flex-1 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Next Level</button>`:''}
                        ${!isCorrect ? `<button class="try-again-btn flex-1 bg-orange-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-orange-600 transition">Try Again</button>` : ''}
                         <button class="back-to-levels-btn flex-1 bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition">Back to Levels</button>
                    </div>
                </div>
            ` : '';
            return `
                 <div class="max-w-4xl mx-auto fade-in">
                    <nav class="mb-6 flex items-center justify-between">
                         <button class="back-to-levels-btn flex items-center text-sm font-semibold text-slate-600 hover:text-slate-900 transition p-2 rounded-lg hover:bg-slate-200">
                            ${ICONS.ChevronLeft} Back to Levels
                        </button>
                        <button class="home-btn flex items-center text-sm font-semibold text-slate-600 hover:text-slate-900 transition p-2 rounded-lg hover:bg-slate-200">
                           ${ICONS.Home} Home
                        </button>
                    </nav>
                    <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 border border-slate-200">
                        <span class="text-sm font-bold uppercase" style="color: ${module.color};">${module.title}</span>
                        <h2 class="text-3xl font-extrabold text-slate-900 mt-1 mb-4">${level.title}</h2>
                        ${hasContent ? `
                        <div class="prose max-w-none text-slate-700 space-y-4">
                           <p>${content.explanation}</p>
                           ${content.visual ? `<div class="bg-slate-100 p-3 rounded-lg text-center font-medium">${content.visual}</div>` : ''}
                           ${content.example ? `<p><strong>Example:</strong> ${content.example}</p>` : ''}
                           ${content.limitations ? `<div class="text-sm text-red-700 bg-red-50 p-3 rounded-lg"><strong>Limitations:</strong> ${content.limitations}</div>` : ''}
                           ${measuresHtml ? `<div class="mt-6 space-y-4"><h4 class="text-lg font-semibold text-slate-800 mb-3">Key Measures:</h4>${measuresHtml}</div>` : ''}
                        </div>
                        ` : ''}
                        ${!isStudyMode ? `
                        <div class="mt-8 pt-8 ${hasContent ? 'border-t-2 border-slate-200' : ''}">
                            <h3 class="text-2xl font-bold mb-4">Challenge: Test Your Knowledge</h3>
                            <p class="mb-4 text-slate-700">${challenge.question}</p>
                            <div class="space-y-3">${optionsHtml}</div>
                            ${!state.showResult ? `
                                <button class="submit-answer-btn mt-6 w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 transition disabled:bg-slate-300 disabled:cursor-not-allowed" ${state.selectedAnswer === null ? 'disabled' : ''}>
                                    Submit Answer
                                </button>
                            ` : ''}
                            ${resultHtml}
                        </div>
                        ` : ''}
                    </div>
                 </div>
            `;
        }
        function renderMultiplayerSetupScreen() {
            const playersHtml = state.multiplayer.players.map((player, index) => `
                <div class="flex items-center gap-2">
                    <label for="player-${index}" class="font-semibold text-slate-600">Player ${index + 1}:</label>
                    <input type="text" id="player-${index}" value="${player.name}" data-player-index="${index}" class="player-name-input flex-grow p-2 border border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    ${state.multiplayer.players.length > 1 ? `<button class="remove-player-btn p-2 text-red-500 hover:bg-red-100 rounded-full" data-player-index="${index}">${ICONS.Trash.replace(/width="24"/g, 'width="20"').replace(/height="24"/g, 'height="20"')}</button>` : ''}
                </div>
            `).join('');
            const moduleOptionsHtml = GAME_MODULES.map(module => `
                <option value="${module.id}" ${state.multiplayer.selectedModuleId === module.id ? 'selected' : ''}>${module.title}</option>
            `).join('');
            return `
                <div class="max-w-2xl mx-auto fade-in">
                     <button class="main-menu-btn mb-6 flex items-center text-sm font-semibold text-slate-600 hover:text-slate-900 transition p-2 rounded-lg hover:bg-slate-200">
                        ${ICONS.ChevronLeft} Back to Main Menu
                    </button>
                    <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                        <h2 class="text-3xl font-extrabold text-slate-900 text-center mb-6">Multiplayer Quiz Setup</h2>
                        <div class="space-y-4 mb-6">
                            <h3 class="font-bold text-lg">Players</h3>
                            ${playersHtml}
                            ${state.multiplayer.players.length < 6 ? `
                                <button class="add-player-btn w-full flex items-center justify-center gap-2 p-2 border-2 border-dashed border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 hover:border-slate-400 transition">
                                    ${ICONS.PlusCircle.replace(/width="24"/g, 'width="20"').replace(/height="24"/g, 'height="20"')}
                                    Add Player
                                </button>
                            ` : ''}
                        </div>
                        <div class="space-y-2 mb-8">
                             <h3 class="font-bold text-lg">Quiz Topic</h3>
                             <select id="module-select" class="w-full p-3 border border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white">
                                ${moduleOptionsHtml}
                             </select>
                        </div>
                        <button class="start-game-btn w-full bg-purple-600 text-white font-bold py-4 rounded-lg text-xl hover:bg-purple-700 transition-transform hover:scale-105 shadow-lg">Start Game</button>
                    </div>
                </div>
            `;
        }
        function renderMultiplayerGameScreen() {
            const { players, currentTurnIndex, quizQuestions, currentQuestionIndex, showAnswer, selectedAnswerIndex } = state.multiplayer;
            const currentPlayer = players[currentTurnIndex];
            const question = quizQuestions[currentQuestionIndex];
            const module = GAME_MODULES.find(m => m.id === state.multiplayer.selectedModuleId);
            const scoreboardHtml = players.map((p, i) => `
                <div class="flex justify-between items-center p-3 rounded-lg ${i === currentTurnIndex && showAnswer !== true ? 'bg-blue-100 border-blue-400 border-2' : 'bg-slate-100'}">
                    <span class="font-bold text-slate-800">${p.name}</span>
                    <span class="font-bold text-lg ${p.score < 0 ? 'text-red-500' : 'text-blue-600'}">${p.score}</span>
                </div>
            `).join('');
            const optionsHtml = question.challenge.options.map((option, index) => {
                let buttonClass = 'border-slate-300 hover:border-blue-500 hover:bg-blue-50';
                if (showAnswer === true) { // Final answer revealed
                     if (index === question.challenge.correct) {
                        buttonClass = 'bg-green-100 border-green-500 text-green-800';
                    } else if (index === selectedAnswerIndex) {
                        buttonClass = 'bg-red-100 border-red-500 text-red-800';
                    } else {
                        buttonClass = 'border-slate-300 opacity-60';
                    }
                } else if (showAnswer === 'feedback' && index === selectedAnswerIndex) { // Temporary feedback on wrong answer
                    buttonClass = 'bg-red-100 border-red-500 text-red-800';
                }
                return `
                    <button class="multiplayer-answer-option w-full text-left p-4 border-2 rounded-lg transition-all ${buttonClass}" data-answer-index="${index}" ${showAnswer !== false ? 'disabled' : ''}>
                        ${option}
                    </button>
                `;
            }).join('');
            let resultPanelHtml = '';
            if (showAnswer === true) {
                const title = state.multiplayer.lastAnswerCorrect ? 'Correct!' : 'Nobody got it right!';
                resultPanelHtml = `
                <div class="mt-6 p-4 rounded-lg ${state.multiplayer.lastAnswerCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
                    <h4 class="font-bold text-lg ${state.multiplayer.lastAnswerCorrect ? 'text-green-800' : 'text-red-800'}">${title}</h4>
                    <p class="text-slate-700 mt-2">${question.challenge.explanation}</p>
                    <button class="next-question-btn mt-4 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition">
                        Next Question
                    </button>
                </div>`;
            } else if (showAnswer === 'feedback') {
                resultPanelHtml = `
                <div class="mt-6 p-4 rounded-lg bg-red-50 border border-red-200">
                    <h4 class="font-bold text-lg text-red-800">Incorrect! Let's see who's next...</h4>
                    <button class="next-player-btn mt-4 w-full bg-orange-500 text-white font-semibold py-3 rounded-lg hover:bg-orange-600 transition">
                        Next Player's Turn
                    </button>
                </div>`;
            }
            return `
                <div class="max-w-7xl mx-auto grid lg:grid-cols-3 gap-8 fade-in">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-8 border border-slate-200">
                         <div class="flex justify-between items-center mb-4">
                            <span class="text-sm font-bold uppercase" style="color: ${module.color};">${module.title}</span>
                            <span class="font-semibold text-slate-500">Question ${currentQuestionIndex + 1} of ${quizQuestions.length}</span>
                         </div>
                         <div class="bg-slate-200 h-2 rounded-full mb-6">
                            <div class="h-full rounded-full" style="width: ${((currentQuestionIndex + 1) / quizQuestions.length) * 100}%; background-color: ${module.color}; transition: width 0.3s ease;"></div>
                         </div>
                         <p class="text-xl font-semibold mb-6 text-slate-800">${question.challenge.question}</p>
                         <div class="space-y-3">${optionsHtml}</div>
                         ${resultPanelHtml}
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white rounded-xl shadow-lg p-6 border border-slate-200">
                            <h3 class="text-2xl font-bold mb-4 text-center">It's your turn, <span style="color: ${module.color};">${currentPlayer.name}</span>!</h3>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6 border border-slate-200">
                             <h3 class="text-xl font-bold mb-4">Scoreboard</h3>
                             <div class="space-y-3">${scoreboardHtml}</div>
                        </div>
                         <button class="quit-game-btn w-full mt-4 text-sm font-semibold text-red-600 hover:text-red-800 transition p-2 rounded-lg hover:bg-red-100">
                            End Game
                        </button>
                    </div>
                </div>
            `;
        }
        function renderMultiplayerResultsScreen() {
             const winners = state.multiplayer.players
                .reduce((acc, player) => {
                    if (!acc.length || player.score > acc[0].score) {
                        return [player];
                    }
                    if (player.score === acc[0].score) {
                        acc.push(player);
                    }
                    return acc;
                }, []);
            const sortedPlayers = [...state.multiplayer.players].sort((a, b) => b.score - a.score);
            const resultsHtml = sortedPlayers.map((p, i) => `
                <div class="flex justify-between items-center p-4 rounded-lg ${winners.some(w => w.name === p.name) ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-slate-100'}">
                    <div class="flex items-center">
                         <span class="font-bold text-2xl w-10 text-slate-500">${i + 1}.</span>
                         <span class="font-bold text-slate-800 text-lg">${p.name}</span>
                         ${winners.some(w => w.name === p.name) ? `<div class="ml-2 text-yellow-500">${ICONS.Award}</div>` : ''}
                    </div>
                    <span class="font-black text-2xl ${p.score < 0 ? 'text-red-500' : 'text-blue-600'}">${p.score}</span>
                </div>
            `).join('');
            return `
                <div class="max-w-2xl mx-auto text-center fade-in">
                    <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                        <h2 class="text-4xl font-extrabold text-slate-900 mb-2">Game Over!</h2>
                        <p class="text-lg text-slate-600 mb-8">
                            ${winners.length > 1 ? 'It\'s a tie! The winners are:' : 'The winner is:'}
                            <strong class="text-blue-600">${winners.map(w => w.name).join(' & ')}</strong>
                        </p>
                        <div class="space-y-3 text-left mb-8">
                            ${resultsHtml}
                        </div>
                        <div class="flex gap-4">
                            <button class="play-again-btn flex-1 bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition">Play Again</button>
                            <button class="main-menu-btn flex-1 bg-slate-200 text-slate-800 font-bold py-3 rounded-lg hover:bg-slate-300 transition">Main Menu</button>
                        </div>
                    </div>
                </div>
            `;
        }
        // --- EVENT HANDLERS & ROUTING ---
        function handleAppClick(e) {
            // Main menu buttons
            const startSinglePlayerBtn = e.target.closest('.start-single-player-btn');
            const startMultiplayerBtn = e.target.closest('.start-multiplayer-btn');
            const startStudyBtn = e.target.closest('.start-study-btn');
            const mainMenuBtn = e.target.closest('.main-menu-btn');
            if (startSinglePlayerBtn) {
                state.gameMode = 'single';
                render();
                return;
            }
            if (startMultiplayerBtn) {
                state.gameMode = 'multiplayer';
                state.multiplayer.status = 'setup';
                render();
                return;
            }
             if (startStudyBtn) {
                state.gameMode = 'study';
                render();
                return;
            }
            if (mainMenuBtn) {
                state.gameMode = 'menu';
                state.currentModuleId = null;
                state.currentLevelIndex = null;
                render();
                return;
            }
            // Single player & Study mode logic
            if(state.gameMode === 'single' || state.gameMode === 'study') {
                const moduleCard = e.target.closest('.module-card');
                const levelCard = e.target.closest('.level-card');
                const answerOption = e.target.closest('.answer-option');
                const submitBtn = e.target.closest('.submit-answer-btn');
                const backToModulesBtn = e.target.closest('.back-to-modules-btn');
                const backToLevelsBtn = e.target.closest('.back-to-levels-btn');
                const homeBtn = e.target.closest('.home-btn');
                const tryAgainBtn = e.target.closest('.try-again-btn');
                const nextLevelBtn = e.target.closest('.next-level-btn');
                const resetProgressBtn = e.target.closest('.reset-progress-btn');
                if (moduleCard) {
                    state.currentModuleId = moduleCard.dataset.moduleId;
                    render();
                } else if (levelCard && !levelCard.hasAttribute('disabled')) {
                    state.currentLevelIndex = parseInt(levelCard.dataset.levelIndex);
                    render();
                } else if (answerOption && state.gameMode === 'single') {
                    state.selectedAnswer = parseInt(answerOption.dataset.answerIndex);
                    render();
                } else if (submitBtn && state.gameMode === 'single') {
                    state.showResult = true;
                    const level = MODULE_CONTENT[state.currentModuleId][state.currentLevelIndex];
                    if (state.selectedAnswer === level.challenge.correct) {
                        state.userProgress[`${state.currentModuleId}-${level.id}`] = true;
                        saveProgress();
                    }
                    render();
                } else if (backToModulesBtn || homeBtn) {
                    state.currentModuleId = null;
                    state.currentLevelIndex = null;
                    state.selectedAnswer = null;
                    state.showResult = false;
                    render();
                } else if (backToLevelsBtn) {
                    state.currentLevelIndex = null;
                    state.selectedAnswer = null;
                    state.showResult = false;
                    render();
                } else if (tryAgainBtn && state.gameMode === 'single') {
                    state.selectedAnswer = null;
                    state.showResult = false;
                    render();
                } else if (nextLevelBtn && state.gameMode === 'single') {
                    state.currentLevelIndex += 1;
                    state.selectedAnswer = null;
                    state.showResult = false;
                    render();
                } else if (resetProgressBtn && state.gameMode === 'single') {
                    resetProgress();
                }
            }
            // Multiplayer logic
            if (state.gameMode === 'multiplayer') {
                const addPlayerBtn = e.target.closest('.add-player-btn');
                const removePlayerBtn = e.target.closest('.remove-player-btn');
                const startGameBtn = e.target.closest('.start-game-btn');
                const multiplayerAnswer = e.target.closest('.multiplayer-answer-option');
                const nextQuestionBtn = e.target.closest('.next-question-btn');
                const nextPlayerBtn = e.target.closest('.next-player-btn');
                const quitGameBtn = e.target.closest('.quit-game-btn');
                const playAgainBtn = e.target.closest('.play-again-btn');
                if (addPlayerBtn && state.multiplayer.players.length < 6) {
                    state.multiplayer.players.push({ name: `Player ${state.multiplayer.players.length + 1}`, score: 0 });
                    render();
                } else if (removePlayerBtn) {
                    const index = parseInt(removePlayerBtn.dataset.playerIndex);
                    state.multiplayer.players.splice(index, 1);
                    render();
                } else if (startGameBtn) {
                    document.querySelectorAll('.player-name-input').forEach(input => {
                        const index = parseInt(input.dataset.playerIndex);
                        state.multiplayer.players[index].name = input.value.trim() || `Player ${index + 1}`;
                    });
                    state.multiplayer.selectedModuleId = document.getElementById('module-select').value;
                    state.multiplayer.status = 'playing';
                    const allQuestions = shuffleArray([...MODULE_CONTENT[state.multiplayer.selectedModuleId]]);
                    state.multiplayer.quizQuestions = allQuestions.slice(0, 10);
                    state.multiplayer.currentQuestionIndex = 0;
                    state.multiplayer.attemptedPlayersForCurrentQuestion = [];
                    state.multiplayer.currentTurnIndex = Math.floor(Math.random() * state.multiplayer.players.length);
                    state.multiplayer.showAnswer = false;
                    state.multiplayer.players.forEach(p => p.score = 0);
                    render();
                } else if (multiplayerAnswer) {
                    const answerIndex = parseInt(multiplayerAnswer.dataset.answerIndex);
                    const question = state.multiplayer.quizQuestions[state.multiplayer.currentQuestionIndex];
                    const isCorrect = answerIndex === question.challenge.correct;
                    state.multiplayer.selectedAnswerIndex = answerIndex;
                    if (isCorrect) {
                        state.multiplayer.players[state.multiplayer.currentTurnIndex].score += 10;
                        state.multiplayer.lastAnswerCorrect = true;
                        state.multiplayer.showAnswer = true;
                    } else {
                        state.multiplayer.players[state.multiplayer.currentTurnIndex].score -= 10;
                        state.multiplayer.lastAnswerCorrect = false;
                        state.multiplayer.attemptedPlayersForCurrentQuestion.push(state.multiplayer.currentTurnIndex);
                        const remainingPlayerIndices = state.multiplayer.players
                            .map((p, i) => i)
                            .filter(i => !state.multiplayer.attemptedPlayersForCurrentQuestion.includes(i));
                        if (remainingPlayerIndices.length > 0) {
                            state.multiplayer.showAnswer = 'feedback';
                        } else {
                            state.multiplayer.showAnswer = true;
                        }
                    }
                    render();
                } else if (nextPlayerBtn) {
                    const remainingPlayerIndices = state.multiplayer.players
                        .map((p, i) => i)
                        .filter(i => !state.multiplayer.attemptedPlayersForCurrentQuestion.includes(i));
                    if (remainingPlayerIndices.length > 0) {
                        const nextPlayerIndex = remainingPlayerIndices[Math.floor(Math.random() * remainingPlayerIndices.length)];
                        state.multiplayer.currentTurnIndex = nextPlayerIndex;
                        state.multiplayer.showAnswer = false;
                        state.multiplayer.selectedAnswerIndex = null;
                    }
                    render();
                } else if (nextQuestionBtn) {
                    state.multiplayer.currentQuestionIndex++;
                    if (state.multiplayer.currentQuestionIndex >= state.multiplayer.quizQuestions.length) {
                        state.multiplayer.status = 'results';
                    } else {
                        state.multiplayer.showAnswer = false;
                        state.multiplayer.selectedAnswerIndex = null;
                        state.multiplayer.attemptedPlayersForCurrentQuestion = [];
                        state.multiplayer.currentTurnIndex = Math.floor(Math.random() * state.multiplayer.players.length);
                    }
                    render();
                } else if (quitGameBtn) {
                    state.multiplayer.status = 'setup';
                    state.multiplayer.players.forEach(p => p.score = 0);
                    render();
                } else if (playAgainBtn) {
                     state.multiplayer.status = 'setup';
                     render();
                }
            }
        }
        // --- UTILITY FUNCTIONS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            appContainer.addEventListener('click', handleAppClick);
            appContainer.addEventListener('change', e => {
                 if (e.target.classList.contains('player-name-input')) {
                    const index = parseInt(e.target.dataset.playerIndex);
                    state.multiplayer.players[index].name = e.target.value;
                 }
                 if (e.target.id === 'module-select') {
                    state.multiplayer.selectedModuleId = e.target.value;
                 }
            });
            render();
        });
    </script>
</body>
</html>
